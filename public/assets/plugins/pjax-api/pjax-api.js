/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/pjax-api@3.34.0/dist/pjax-api.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*! pjax-api v3.34.0 https://github.com/falsandtru/pjax-api | (c) 2012, falsandtru | (Apache-2.0 AND MPL-2.0) License */
require=function e(t,r,n){function i(o,c){if(!r[o]){if(!t[o]){var a="function"==typeof require&&require;if(!c&&a)return a(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[o]={exports:{}};t[o][0].call(l.exports,(function(e){return i(t[o][1][e]||e)}),l,l.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{dup:1}],3:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{dup:1}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isArray=r.ObjectValues=r.ObjectSetPrototypeOf=r.ObjectSeal=r.ObjectPreventExtensions=r.ObjectKeys=r.isSealed=r.isFrozen=r.isExtensible=r.ObjectIs=r.ObjectGetPrototypeOf=r.ObjectGetOwnPropertySymbols=r.ObjectGetOwnPropertyNames=r.ObjectGetOwnPropertyDescriptors=r.ObjectGetOwnPropertyDescriptor=r.ObjectFromEntries=r.ObjectFreeze=r.ObjectEntries=r.ObjectDefineProperty=r.ObjectDefineProperties=r.ObjectCreate=r.ObjectAssign=r.toString=r.isEnumerable=r.isPrototypeOf=r.hasOwnProperty=r.SymbolKeyFor=r.SymbolFor=r.sign=r.round=r.random=r.min=r.max=r.floor=r.ceil=r.abs=r.parseInt=r.parseFloat=r.isSafeInteger=r.isNaN=r.isInteger=r.isFinite=r.NaN=void 0,r.NaN=Number.NaN,r.isFinite=Number.isFinite,r.isInteger=Number.isInteger,r.isNaN=Number.isNaN,r.isSafeInteger=Number.isSafeInteger,r.parseFloat=Number.parseFloat,r.parseInt=Number.parseInt,r.abs=Math.abs,r.ceil=Math.ceil,r.floor=Math.floor,r.max=Math.max,r.min=Math.min,r.random=Math.random,r.round=Math.round,r.sign=Math.sign,r.SymbolFor=Symbol.for,r.SymbolKeyFor=Symbol.keyFor,r.hasOwnProperty=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),r.isPrototypeOf=Object.prototype.isPrototypeOf.call.bind(Object.prototype.isPrototypeOf),r.isEnumerable=Object.prototype.propertyIsEnumerable.call.bind(Object.prototype.propertyIsEnumerable),r.toString=Object.prototype.toString.call.bind(Object.prototype.toString),r.ObjectAssign=Object.assign,r.ObjectCreate=Object.create,r.ObjectDefineProperties=Object.defineProperties,r.ObjectDefineProperty=Object.defineProperty,r.ObjectEntries=Object.entries,r.ObjectFreeze=Object.freeze,r.ObjectFromEntries=Object.fromEntries,r.ObjectGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,r.ObjectGetOwnPropertyDescriptors=Object.getOwnPropertyDescriptors,r.ObjectGetOwnPropertyNames=Object.getOwnPropertyNames,r.ObjectGetOwnPropertySymbols=Object.getOwnPropertySymbols,r.ObjectGetPrototypeOf=Object.getPrototypeOf,r.ObjectIs=Object.is,r.isExtensible=Object.isExtensible,r.isFrozen=Object.isFrozen,r.isSealed=Object.isSealed,r.ObjectKeys=Object.keys,r.ObjectPreventExtensions=Object.preventExtensions,r.ObjectSeal=Object.seal,r.ObjectSetPrototypeOf=Object.setPrototypeOf,r.ObjectValues=Object.values,r.isArray=Array.isArray},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.join=r.splice=r.pop=r.push=r.shift=r.unshift=r.indexOf=void 0;const n=e("./global");function i(e,t){if("length"in e)for(let r=e.length-1;r>=0;--r)t.unshift(e[r]);else t.unshift(...e);return t}function s(e,t){if("length"in t)for(let r=0,n=t.length;r<n;++r)e.push(t[r]);else for(const r of t)e.push(r);return e}function o(e,t,r,...c){if(0===r&&0===c.length)return[];switch(r=r>e.length?e.length:r,t){case 0:switch(r){case 0:return[[],i(c,e)][0];case 1:return 0===e.length?[[],i(c,e)][0]:[[e.shift()],i(c,e)][0];case void 0:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:o(e,t,1)}break;case-1:case e.length-1:switch(r){case 1:return 0===e.length?[[],s(e,c)][0]:[[e.pop()],s(e,c)][0];case void 0:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:o(e,t,1)}break;case e.length:case n.Infinity:return[[],s(e,c)][0]}return arguments.length>2?e.splice(t,r,...c):e.splice(t)}r.indexOf=function(e,t){return 0===e.length?-1:t==t?e.indexOf(t):e.findIndex((e=>e!=e))},r.unshift=i,r.shift=function(e,t){if(t<0)throw new Error("Unexpected negative number");return void 0===t?[e.shift(),e]:[o(e,0,t),e]},r.push=s,r.pop=function(e,t){if(t<0)throw new Error("Unexpected negative number");return void 0===t?[e,e.pop()]:[e,o(e,e.length-t,t)]},r.splice=o,r.join=function(e,t=""){let r="";for(let n=0;n<e.length;++n)r+=0===n?e[n]:t+e[n];return r}},{"./global":20}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.template=r.overwrite=r.inherit=r.merge=r.extend=r.clone=r.assign=void 0;const n=e("./global"),i=e("./alias"),s=e("./type"),o=e("./array");function c(e){return function(t,...r){if((0,s.isPrimitive)(t))return t;for(let n=0;n<r.length;++n){const o=r[n];if(o===t)continue;if((0,s.isPrimitive)(o))continue;const c=(0,i.ObjectKeys)(o);for(let r=0;r<c.length;++r)e(c[r],t,o)}return t}}function a(e){switch((0,s.type)(e)){case"Array":return[];case"Object":return e instanceof n.Object?{}:(0,i.ObjectCreate)(null);default:return e}}r.assign=c(((e,t,r)=>t[e]=r[e])),r.clone=c(((e,t,n)=>{switch((0,s.type)(n[e])){case"Array":return t[e]=n[e].slice();case"Object":return"Object"===(0,s.type)(t[e])?t[e]=(0,r.clone)(a(n[e]),n[e]):t[e]=n[e];default:return t[e]=n[e]}})),r.extend=c(((e,t,n)=>{switch((0,s.type)(n[e])){case"undefined":return;case"Array":default:return t[e]=n[e];case"Object":return"Object"===(0,s.type)(t[e])?t[e]=(0,r.extend)(t[e],n[e]):t[e]=(0,r.extend)(a(n[e]),n[e])}})),r.merge=c(((e,t,n)=>{switch((0,s.type)(n[e])){case"undefined":return;case"Array":return"Array"===(0,s.type)(t[e])?t[e]=(0,o.push)(t[e],n[e]):t[e]=n[e].slice();case"Object":return"Object"===(0,s.type)(t[e])?t[e]=(0,r.merge)(t[e],n[e]):t[e]=(0,r.merge)(a(n[e]),n[e]);default:return t[e]=n[e]}})),r.inherit=c(((e,t,n)=>{switch((0,s.type)(n[e])){case"undefined":return;case"Array":return t[e]=n[e].slice();case"Object":return"Object"===(0,s.type)(t[e])?t[e]=(0,i.hasOwnProperty)(t,e)?(0,r.inherit)(t[e],n[e]):(0,r.inherit)((0,i.ObjectCreate)(t[e]),n[e]):t[e]=(0,i.ObjectCreate)(n[e]);default:return t[e]=n[e]}})),r.overwrite=c(((e,t,n)=>{switch((0,s.type)(n[e])){case"Array":default:return t[e]=n[e];case"Object":return"Object"===(0,s.type)(t[e])?t[e]=(0,r.overwrite)(t[e],n[e]):t[e]=(0,r.overwrite)(a(n[e]),n[e])}})),r.template=c},{"./alias":4,"./array":5,"./global":20,"./type":97}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Cache=void 0;const n=e("./global"),i=e("./clock"),s=e("./invlist"),o=e("./assign"),c=e("./tuple");class a{constructor(e,t={}){var r;this.settings={capacity:0,space:n.Infinity,age:n.Infinity,life:10,limit:95,capture:{delete:!0,clear:!0}},this.SIZE=0,this.clock=n.Number.MIN_SAFE_INTEGER,this.clockR=n.Number.MIN_SAFE_INTEGER,this.memory=new n.Map,this.indexes={LRU:new s.List,LFU:new s.List,OVF:new s.List},this.stats={LRU:(0,c.tuple)(0,0),LFU:(0,c.tuple)(0,0),slide(){const{LRU:e,LFU:t}=this;e[1]=e[0],e[0]=0,t[1]=t[0],t[0]=0},clear(){const{LRU:e,LFU:t}=this;e[0]=e[1]=0,t[0]=t[1]=0}},this.ratio=50,"object"==typeof e&&(e=null!==(r=(t=e).capacity)&&void 0!==r?r:0);const i=(0,o.extend)(this.settings,t,{capacity:e});if(this.capacity=i.capacity,this.capacity>=1==!1)throw new Error("Spica: Cache: Capacity must be 1 or more.");this.space=i.space,this.life=this.capacity*i.life,this.limit=i.limit}get length(){return this.indexes.LRU.length+this.indexes.LFU.length}get size(){return this.SIZE}evict(e,t,r){var n,i,s;const o=e.value;r&&(r=!!this.settings.disposer),t=r?null!=t?t:this.memory.get(o.key):t,e.delete(),null===(n=e.value.overflow)||void 0===n||n.delete(),this.memory.delete(o.key),this.SIZE-=o.size,r&&(null===(s=(i=this.settings).disposer)||void 0===s||s.call(i,t.value,o.key))}ensure(e,t){var r,s,o;t&&(t.value.clock=this.clock,t.value.expiry=n.Infinity);let c=null!==(r=null==t?void 0:t.value.size)&&void 0!==r?r:0;if(e-c<=0)return;const{LRU:a,LFU:u,OVF:l}=this.indexes;for(;this.length===this.capacity||this.size+e-c>this.space;){const e=null!==(s=l.last)&&void 0!==s?s:u.last,r=null==e?void 0:e.value;let h;switch(!0){case r&&r.clock<this.clock-this.life:case r&&r.expiry!==n.Infinity&&r.expiry<(0,i.now)():h=e.list===l?e.value.parent:e;break;case 0===a.length:h=u.last!==t?u.last:u.last.prev;break;case u.length>this.capacity*this.ratio/100:a.unshiftNode(u.last),a.head.value.parent=a.head,a.head.value.overflow=l.unshift(a.head.value);default:h=a.last!==t?a.last:a.last.prev!==t?a.last.prev:u.last}this.evict(h,void 0,!0),c=null!==(o=null==(t=(null==t?void 0:t.list)&&t)?void 0:t.value.size)&&void 0!==o?o:0}}put(e,t,r=1,s=this.settings.age){var o,c,a,u;if(r>=1==!1)throw new Error("Spica: Cache: Size must be 1 or more.");if(s>=1==!1)throw new Error("Spica: Cache: Age must be 1 or more.");if(r>this.space||s<=0)return null===(c=(o=this.settings).disposer)||void 0===c||c.call(o,t,e),!1;const l=s===n.Infinity?n.Infinity:(0,i.now)()+s,h=this.memory.get(e);if(h){const n=h.index,i=h.value,s=n.value;return this.ensure(r,n),s.clock="LRU"===s.region?++this.clockR:++this.clock,s.expiry=l,this.SIZE+=r-s.size,s.size=r,h.value=t,null===(u=(a=this.settings).disposer)||void 0===u||u.call(a,i,e),!0}this.ensure(r);const{LRU:d}=this.indexes;return this.SIZE+=r,this.memory.set(e,{index:d.unshift({key:e,size:r,clock:++this.clockR,expiry:l,region:"LRU"}),value:t}),!1}set(e,t,r,n){return this.put(e,t,r,n),this}get(e){const t=this.memory.get(e);if(!t)return;const r=t.index,s=r.value.expiry;if(!(s!==n.Infinity&&s<(0,i.now)()))return this.capacity>=10&&r===r.list.head||(this.access(r),this.slide()),t.value;this.evict(r,t,!0)}has(e){const t=this.memory.get(e);if(!t)return!1;const r=t.index.value.expiry;return!(r!==n.Infinity&&r<(0,i.now)())||(this.evict(t.index,t,!0),!1)}delete(e){const t=this.memory.get(e);return!!t&&(this.evict(t.index,t,!0===this.settings.capture.delete),!0)}clear(){if(this.SIZE=0,this.ratio=50,this.stats.clear(),this.indexes.LRU.clear(),this.indexes.LFU.clear(),this.indexes.OVF.clear(),!this.settings.disposer||!this.settings.capture.clear)return void this.memory.clear();const e=this.memory;this.memory=new n.Map;for(const[t,{value:r}]of e)this.settings.disposer(r,t)}*[Symbol.iterator](){for(const[e,{value:t}]of this.memory)yield[e,t]}slide(){const{LRU:e,LFU:t}=this.stats,{capacity:r,ratio:n,limit:i,indexes:s}=this,o=r;if(e[0]+t[0]===o&&this.stats.slide(),100*(e[0]+t[0])%r||e[1]+t[1]===0)return;const c=s.LRU.length,a=s.LFU.length,l=1e3*(a+s.OVF.length)/(c+a)|0,h=u(o,e[0],e[0]+t[0],e[1],e[1]+t[1],0)*(1+l),d=u(o,t[0],e[0]+t[0],t[1],e[1]+t[1],0)*(1001-l),p=u(o,t[1],e[1]+t[1],t[0],e[0]+t[0],5)*(1001-l);n>0&&(h>d||d<.95*p)?c>=r*(100-n)/100&&--this.ratio:n<i&&d>h&&a>=r*n/100&&++this.ratio}access(e){return this.accessLFU(e)||this.accessLRU(e)}accessLRU(e){var t;const r=e.value,{LRU:n,LFU:i}=this.indexes;return++this.stats[r.region][0],!r.overflow&&r.clock>=this.clockR-n.length/3&&this.capacity>3?(r.clock=++this.clockR,e.moveToHead(),!0):(r.clock=++this.clock,r.region="LFU",null===(t=r.overflow)||void 0===t||t.delete(),i.unshiftNode(e),!0)}accessLFU(e){const t=e.value,{LFU:r}=this.indexes;return e.list===r&&(++this.stats[t.region][0],t.clock=++this.clock,e.moveToHead(),!0)}}function u(e,t,r,n,i,s){const o=100*n/i|0,c=100*r/e-s|0;if(c<=0)return 100*o;return(100*t/r|0)*c+o*(100-c)}r.Cache=a},{"./assign":6,"./clock":10,"./global":20,"./invlist":23,"./tuple":96}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Cancellation=void 0;const n=e("./global"),i=e("./function"),s=e("./noop"),o=e("./promise"),c=e("./exception"),a=e("./maybe"),u=e("./either"),l=Symbol.for("spica/cancellation::internal");class h extends o.AtomicPromise{constructor(e=[]){var t;super((e=>t=e)),this[l]=new d(t);for(const t of e)t.register(this.cancel)}get alive(){return this[l].alive}get cancelled(){return this[l].cancelled}get register(){return e=>this[l].register(e)}get cancel(){return e=>this[l].cancel(e)}get close(){return e=>this[l].close(e)}get promise(){return e=>this[l].promise(e)}get maybe(){return e=>this[l].maybe(e)}get either(){return e=>this[l].either(e)}}r.Cancellation=h;class d{constructor(e){this.resolve=e,this.alive=!0,this.available=!0,this.listeners=new n.Set}get cancelled(){return"reason"in this}register(e){return this.alive?(this.listeners.add(t),(0,i.singleton)((()=>{this.listeners.delete(t)}))):(this.cancelled&&t(this.reason),s.noop);function t(t){try{e(t)}catch(t){(0,c.causeAsyncException)(t)}}}cancel(e){if(this.available){this.available=!1,this.reason=e;for(const t of this.listeners)t(e);this.resolve(this.reason),this.alive=!1}}close(e){this.available&&(this.available=!1,this.resolve(o.AtomicPromise.reject(e)),this.alive=!1)}promise(e){return this.cancelled?o.AtomicPromise.reject(this.reason):o.AtomicPromise.resolve(e)}maybe(e){return(0,a.Just)(e).bind((e=>this.cancelled?a.Nothing:(0,a.Just)(e)))}either(e){return(0,u.Right)(e).bind((e=>this.cancelled?(0,u.Left)(this.reason):(0,u.Right)(e)))}}},{"./either":15,"./exception":16,"./function":18,"./global":20,"./maybe":28,"./noop":86,"./promise":88}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Channel=void 0;const n=e("./promise"),i=e("./future"),s=()=>n.AtomicPromise.reject(new Error("Spica: Channel: Closed.")),o=Symbol.for("spica/channel::internal");class c{constructor(e=0){this[o]=new a(e)}get alive(){return this[o].alive}close(e){if(!this.alive)return;const t=this[o],{buffer:r,producers:i,consumers:c}=t;for(t.alive=!1;i.length||c.length;)i.length&&i.shift().bind(s()),c.length&&c.shift().bind(s());e&&n.AtomicPromise.all(r).then(e)}put(e){if(!this.alive)return s();const{capacity:t,buffer:r,producers:c,consumers:a}=this[o];switch(!0){case r.length<t:case a.length>0:return r.push(e),a.length>0&&a.shift().bind(r.shift()),n.AtomicPromise.resolve();default:return c[c.push(new i.AtomicFuture)-1].then((()=>this.put(e)))}}take(){if(!this.alive)return s();const{buffer:e,producers:t,consumers:r}=this[o];switch(!0){case e.length>0:const s=e.shift();return t.length>0&&t.shift().bind(),n.AtomicPromise.resolve(s);case t.length>0:const o=r[r.push(new i.AtomicFuture)-1];return t.shift().bind(),o.then();default:return r[r.push(new i.AtomicFuture)-1].then()}}get size(){return this[o].buffer.length}async*[Symbol.asyncIterator](){try{for(;this.alive;)yield this.take()}catch(e){if(this.alive)throw e}}}r.Channel=c;class a{constructor(e=0){this.capacity=e,this.alive=!0,this.buffer=[],this.producers=[],this.consumers=[]}}},{"./future":19,"./promise":88}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tick=r.clock=r.now=void 0;const n=e("./global"),i=e("./alias"),s=e("./exception");let o,c=0;r.now=function(){if(void 0===o)d((()=>o=void 0));else{if(100!=++c)return o;c=0}return o=n.Date.now()},r.clock=Promise.resolve(void 0);let a=[],u=[],l=0;const h=Promise.resolve();function d(e){0===l&&h.then(p),l++===a.length?a.push(e):a[l-1]=e}function p(){const e=l;[l,a,u]=[0,u,a];for(let t=0;t<e;++t)try{u[t](),u[t]=void 0}catch(e){(0,s.causeAsyncException)(e)}u.length>1e3&&e<.5*u.length&&u.splice((0,i.floor)(.9*u.length),u.length)}r.tick=d},{"./alias":4,"./exception":16,"./global":20}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.equal=void 0,r.equal=function(e,t){return e==e?e===t:t!=t}},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Copropagator=void 0;const n=e("./global"),i=e("./alias"),s=e("./coroutine"),o=e("./promise");class c extends s.Coroutine{constructor(e,t=(e=>e[0]),r){super((async function*(){return this.then((t=>{for(const r of e)r[s.Coroutine.exit](t)}),(t=>{const r=o.AtomicPromise.reject(t);for(const t of e)t[s.Coroutine.exit](r)})),a(e).then((e=>0===e.length?void this[s.Coroutine.terminate](new n.Error("Spica: Copropagator: No result.")):void this[s.Coroutine.exit](t(e))),(e=>{this[s.Coroutine.terminate](e)})),o.never}),{delay:!1,...r})}}function a(e,t){const r=(0,i.isArray)(e)?e:[...e];return o.AtomicPromise.all(r).then((s=>{const o=(0,i.isArray)(e)?e:[...e],c=o.length===r.length&&o.every(((e,t)=>o[t]===r[t]));if(!t&&c)return s;null!=t||(t=new n.Map);for(let e=0;e<s.length;++e)t.set(r[e],s[e]);return c?[...t.values()]:a(o,t)}))}r.Copropagator=c},{"./alias":4,"./coroutine":13,"./global":20,"./promise":88}],13:[function(e,t,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.isCoroutine=r.Coroutine=void 0;const s=e("./global"),o=e("./alias"),c=e("./clock"),a=e("./timer"),u=e("./promise"),l=e("./future"),h=e("./channel"),d=e("./assign"),p=e("./exception"),f=e("./noop"),m=Symbol.for("spica/Coroutine.alive"),v=Symbol.for("spica/Coroutine.init"),b=Symbol.for("spica/Coroutine.exit"),y=Symbol.for("spica/Coroutine.terminate"),g=Symbol.for("spica/Coroutine.port"),w=Symbol.for("spica/coroutine::internal");class S extends u.AtomicPromise{constructor(e,t={}){var r;super((e=>r=e)),this[n]=new O(this),this[w]=new q(t);let i=0;this[S.init]=async()=>{const t=this[w];if(!t.alive)return;if(0!==i)return;let r=f.noop;try{const n=e.call(this);for(;t.alive;){const[[e,o]]=1==++i?[[void 0,f.noop]]:await s.Promise.all([t.settings.capacity<0?[void 0,f.noop]:t.sendBuffer.take(),s.Promise.all([t.settings.resume(),t.settings.interval>0?(0,a.wait)(t.settings.interval):void 0])]);if(r=o,!t.alive)break;const c=await n.next(e);if(c.done)return t.alive=!1,r({...c}),t.recvBuffer.put({...c}),void t.result.bind(c);r({...c}),await t.recvBuffer.put({...c})}r(u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled.")))}catch(e){r(u.AtomicPromise.reject(e)),this[S.terminate](e)}};const l=this[w];if(r(l.result.then((({value:e})=>e))),void 0!==l.settings.trigger)for(const e of(0,s.Array)().concat(l.settings.trigger))if(!(e in this)||!this.hasOwnProperty(e))if(e in this)(0,o.ObjectDefineProperty)(this,e,{set(t){delete this[e],this[e]=t,this[v]()},get(){return delete this[e],this[v](),this[e]},enumerable:!0,configurable:!0});else{const t=(0,o.ObjectGetOwnPropertyDescriptor)(this,e)||{value:this[e],enumerable:!0,configurable:!0,writable:!0};(0,o.ObjectDefineProperty)(this,e,{set(r){(0,o.ObjectDefineProperty)(this,e,{...t,value:r}),this[v]()},get(){return this[e]},enumerable:!0,configurable:!0})}this[w].settings.run&&(this[w].settings.delay?(0,c.tick)(this[S.init]):this[S.init]())}get[m](){return this[w].alive}[b](e){this[w].alive&&u.AtomicPromise.resolve(e).then((e=>{const t=this[w];t.alive&&(t.alive=!1,t.recvBuffer.put({value:void 0,done:!0}),t.result.bind({value:e}))}),(e=>{const t=this[w];t.alive&&(t.alive=!1,t.recvBuffer.put({value:void 0,done:!0}),t.result.bind(u.AtomicPromise.reject(e)))}))}[y](e){return this[b](u.AtomicPromise.reject(e))}async*[Symbol.asyncIterator](){const e=this[w],t=this[S.port];for(;e.alive;){const e=await t.recv();if(e.done)return e.value;yield e.value}return this}}r.Coroutine=S,n=g,S.alive=m,S.init=v,S.exit=b,S.terminate=y,S.port=g;class q{constructor(e){this.opts=e,this.settings=(0,d.extend)({run:!0,delay:!0,capacity:-1,interval:0,resume:f.noop,trigger:void 0},this.opts),this.alive=!0,this.reception=0,this.sendBuffer=this.settings.capacity>=0?new h.Channel(this.settings.capacity):void 0,this.recvBuffer=this.settings.capacity>=0?new h.Channel(0):new j,this.result=new l.AtomicFuture,this.result.finally((()=>{var e;null===(e=this.sendBuffer)||void 0===e||e.close((e=>{for(;e.length>0;){const[,t]=e.shift();try{t(u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled.")))}catch(e){(0,p.causeAsyncException)(e)}}})),this.recvBuffer.close()}))}}class O{constructor(e){this[w]={co:e}}ask(e){const t=this[w].co[w];if(!t.alive)return u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."));if(t.settings.capacity<0)return u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Overflowed."));t.settings.capacity>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const r=new l.Future;return t.sendBuffer.put([e,r.bind]),++t.reception,s.Promise.all([r,t.recvBuffer.take()]).then((([e])=>e.done?t.result.then((({value:t})=>({...e,value:t}))):{...e}))}recv(){const e=this[w].co[w];return e.alive?(++e.reception,s.Promise.resolve(e.recvBuffer.take()).then((t=>t.done?e.result.then((({value:e})=>({...t,value:e}))):{...t}))):u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."))}send(e){const t=this[w].co[w];if(!t.alive)return u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."));if(t.settings.capacity<0)return u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Overflowed."));t.settings.capacity>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const r=new l.Future;return s.Promise.resolve(t.sendBuffer.put([e,r.bind]))}connect(e){const t=this[w].co[w];return t.alive?(async()=>{t.settings.capacity>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const r=e.call(this[w].co);let n;for(;;){const e=await r.next(n);if(e.done)return e.value;n=(await this.ask(e.value)).value}})():u.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."))}}r.isCoroutine=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.constructor&&"symbol"==typeof e.constructor.alive&&"boolean"==typeof e[e.constructor.alive]&&"symbol"==typeof e.constructor.init&&"function"==typeof e[e.constructor.init]&&"symbol"==typeof e.constructor.exit&&"function"==typeof e[e.constructor.exit]&&"symbol"==typeof e.constructor.terminate&&"function"==typeof e[e.constructor.terminate]&&"symbol"==typeof e.constructor.port&&"object"==typeof e[e.constructor.port]};class j{constructor(){this[i]=new j.Internal}get alive(){return this[w].alive}close(e){var t;if(!this.alive)return;const r=this[w],{consumers:n}=r;r.alive=!1;for(let e=0;n[e];++e)null===(t=n[e])||void 0===t||t.bind(j.fail());n.splice(0,n.length),e&&e([])}put(e){if(!this.alive)return j.fail();const{consumers:t}=this[w];for(;t.length>0;)t.shift().bind(e);return u.AtomicPromise.resolve()}take(){if(!this.alive)return j.fail();const{consumers:e}=this[w];return e[e.push(new l.AtomicFuture)-1].then()}}i=w,function(e){e.fail=()=>u.AtomicPromise.reject(new s.Error("Spica: Channel: Closed."));e.Internal=class{constructor(){this.alive=!0,this.consumers=[]}}}(j||(j={}))},{"./alias":4,"./assign":6,"./channel":9,"./clock":10,"./exception":16,"./future":19,"./global":20,"./noop":86,"./promise":88,"./timer":95}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uncurry=r.curry=void 0;const n=e("./array");function i(e,t,...r){let n;return r.length<t?(...s)=>i(null!=n?n:n=r.length&&e.bind(void 0,...r)||e,t-r.length,...s):e(...r)}r.curry=e=>i(e,e.length);function s(e){const t=e.length;return(...r)=>0===t||r.length<=t?e(...r):s(e(...(0,n.shift)(r,t)[0]))(...r)}r.uncurry=e=>s(e)},{"./array":5}],15:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./monad/either"),r)},{"./monad/either":32}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.causeAsyncException=void 0,r.causeAsyncException=function(e){Promise.reject(e)}},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.flip=void 0,r.flip=function(e){return e.length>1?(t,r)=>e(r,t):(t,...r)=>0===r.length?r=>e(r)(t):e(r[0])(t)}},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clear=r.singleton=void 0;const n=e("./noop");r.singleton=function(e){let t;return function(...r){return e===n.noop||(t=e.call(this,...r),e=n.noop),t}},r.clear=function(e){return(...t)=>{e(...t)}}},{"./noop":86}],19:[function(e,t,r){"use strict";var n,i,s,o;Object.defineProperty(r,"__esModule",{value:!0}),r.AtomicFuture=r.Future=void 0;const c=e("./global"),a=e("./promise"),u=Symbol.for("spica/promise::internal");class l{constructor(e=!0){this[n]="Promise",this[i]=new a.Internal,this.bind=t=>{const r=this[u];if(!r.isPending&&!e)return this;if(!r.isPending)throw new Error("Spica: Future: Cannot rebind a value.");return r.resolve(t),this}}static get[Symbol.species](){return c.Promise}then(e,t){return new c.Promise(((r,n)=>this[u].then(r,n,e,t)))}catch(e){return this.then(void 0,e)}finally(e){return this.then(e,e).then((()=>this))}}r.Future=l,n=Symbol.toStringTag,i=u;class h{constructor(e=!0){this[s]="Promise",this[o]=new a.Internal,this.bind=t=>{const r=this[u];if(!r.isPending&&!e)return this;if(!r.isPending)throw new Error("Spica: AtomicFuture: Cannot rebind a value.");return r.resolve(t),this}}static get[Symbol.species](){return a.AtomicPromise}then(e,t){return new a.AtomicPromise(((r,n)=>this[u].then(r,n,e,t)))}catch(e){return this.then(void 0,e)}finally(e){return this.then(e,e).then((()=>this))}}r.AtomicFuture=h,s=Symbol.toStringTag,o=u},{"./global":20,"./promise":88}],20:[function(_dereq_,module,exports){"use strict";const global="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||Function("return this")();eval("global.global = global"),module.exports=global},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.compose=void 0,r.compose=function(e,...t){return t.reduce(((e,t)=>(Object.getOwnPropertyNames(t.prototype).filter((t=>!(t in e.prototype))).forEach((r=>e.prototype[r]=t.prototype[r])),Object.getOwnPropertyNames(t).filter((t=>!(t in e))).forEach((r=>e[r]=t[r])),e)),e)}},{}],22:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./list/hlist"),r)},{"./list/hlist":25}],23:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./list/invlist"),r)},{"./list/invlist":26}],24:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./list/ixlist"),r)},{"./list/ixlist":27}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HList=void 0;const n=e("../array");r.HList=function(...e){return e.reduceRight(((e,t)=>e.add(t)),i)};const i=new class{add(e){return new s(e,this)}reverse(){return[]}tuple(){return[]}};class s{constructor(e,t){this.head=e,this.tail=t}add(e){return new s(e,this)}modify(e){return this.tail.add(e(this.head))}fold(e){return this.tail.modify((t=>e(this.head,t)))}unfold(e){return this.add(e(this.head))}reverse(){return this.tuple().reverse()}tuple(){return(0,n.unshift)([this.head],this.tail.tuple())}}},{"../array":5}],26:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.List=void 0;const i=void 0,s=Symbol("length");class o{constructor(){this[n]=0,this.head=i}get length(){return this[s]}get tail(){var e;return null===(e=this.head)||void 0===e?void 0:e.next}get last(){var e;return null===(e=this.head)||void 0===e?void 0:e.prev}clear(){this.head=i,this[s]=0}unshift(e){return this.head=this.push(e)}unshiftNode(e){return this.head=this.pushNode(e)}unshiftRotationally(e){const t=this.last;return t?(t.value=e,this.head=t,t):this.unshift(e)}shift(){var e;return null===(e=this.head)||void 0===e?void 0:e.delete()}push(e){var t;return new c(e,this.head,null===(t=this.head)||void 0===t?void 0:t.prev,this)}pushNode(e){return this.insert(e,this.head)}pushRotationally(e){const t=this.head;return t?(t.value=e,this.head=t.next,t):this.push(e)}pop(){var e;return null===(e=this.last)||void 0===e?void 0:e.delete()}insert(e,t=this.head){var r,n;if(e.list===this)return t&&e.move(t),e;e.delete(),++this[s],null!==(r=this.head)&&void 0!==r||(this.head=e),e.list=this;const i=e.next=null!=t?t:e,o=e.prev=null!==(n=i.prev)&&void 0!==n?n:e;return i.prev=o.next=e,e}*[(n=s,Symbol.iterator)](){for(let e=this.head;e;)if(yield e.value,e=e.next,e===this.head)return}}r.List=o;class c{constructor(e,t,r,n){var i,c;void 0===n&&(n=null!==(i=null==t?void 0:t.list)&&void 0!==i?i:new o),this.value=e,this.next=t,this.prev=r,this.list=n,++n[s],null!==(c=n.head)&&void 0!==c||(n.head=this),t&&r?t.prev=r.next=this:this.next=this.prev=this}delete(){return this.list?(--this.list[s],this.list.head===this&&(this.list.head=this.next===this?i:this.next),this.next&&(this.next.prev=this.prev),this.prev&&(this.prev.next=this.next),this.list=i,this.next=this.prev=i,this.value):this.value}insertBefore(e){return new c(e,this,this.prev,this.list)}insertAfter(e){return new c(e,this.next,this,this.list)}move(e){if(!e)return!1;if(this===e)return!1;if(e.list!==this.list)return e.list.insert(this,e),!0;const t=this,r=e;if(!r)return!1;if(t.next===r)return!1;const n=r.prev,i=t.prev,s=t.next;return n.next=t,t.next=r,r.prev=t,t.prev=n,i.next=s,s.prev=i,!0}moveToHead(){this.move(this.list.head),this.list.head=this}moveToLast(){this.move(this.list.head)}swap(e){const t=this,r=e;if(t===r)return!1;const n=r.next;if(t.list!==r.list)throw new Error("Spica: InvList: Cannot swap nodes across lists.");switch(r.move(t),t.move(n),this.list.head){case t:this.list.head=r;break;case r:this.list.head=t}return!0}}},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.List=void 0;const n=e("../global"),i=e("../alias"),s=e("../stack"),o=e("../compare"),c=void 0,a=1e9;class u{constructor(e=n.Infinity,t){this.heap=new s.Stack,this.HEAD=0,this.CURSOR=0,this.LENGTH=0,"object"==typeof e&&(t=e,e=n.Infinity),this.capacity=e,this.index=t,this.nodes=this.capacity<=a?(0,n.Array)((0,i.min)(this.capacity,a)):{}}get length(){return this.LENGTH}get head(){return this.nodes[this.HEAD]}get tail(){const e=this.head;return e&&this.nodes[e.next]}get last(){const e=this.head;return e&&this.nodes[e.prev]}node(e){return 0<=e&&e<this.capacity?this.nodes[e]:c}rotateToNext(){var e,t;return this.HEAD=null!==(t=null===(e=this.tail)||void 0===e?void 0:e.index)&&void 0!==t?t:this.HEAD}rotateToPrev(){var e,t;return this.HEAD=null!==(t=null===(e=this.last)||void 0===e?void 0:e.index)&&void 0!==t?t:this.HEAD}clear(){var e;this.nodes=this.capacity<=a?(0,n.Array)((0,i.min)(this.capacity,a)):{},this.heap.clear(),null===(e=this.index)||void 0===e||e.clear(),this.HEAD=0,this.CURSOR=0,this.LENGTH=0}add(e,t){var r,n;this.LENGTH===a&&"length"in this.nodes&&(this.nodes={...this.nodes});const i=this.nodes,s=i[this.HEAD];if(!s){const n=this.HEAD=this.CURSOR=this.heap.length>0?this.heap.pop():this.length;return++this.LENGTH,null===(r=this.index)||void 0===r||r.set(e,n),i[n]={index:n,key:e,value:t,next:n,prev:n},n}if(this.length!==this.capacity){const r=this.HEAD=this.CURSOR=this.heap.length>0?this.heap.pop():this.length;return++this.LENGTH,null===(n=this.index)||void 0===n||n.set(e,r),i[r]={index:r,key:e,value:t,next:s.index,prev:s.prev},s.prev=i[s.prev].next=r,r}{const r=i[s.prev],n=this.HEAD=this.CURSOR=r.index;return this.index&&!(0,o.equal)(r.key,e)&&(this.index.delete(r.key,n),this.index.set(e,n)),r.key=e,r.value=t,n}}put(e,t,r){const n=this.find(e,r);return n?(n.value=t,n.index):this.add(e,t)}find(e,t=this.CURSOR){var r;let n;if(n=this.node(t),n&&(0,o.equal)(n.key,e))return this.CURSOR=t,n;if(!this.index)throw new Error("Spica: IxList: Need the index but not given.");return(n?1!==this.length:0!==this.length)?(n=this.node(t=null!==(r=this.index.get(e))&&void 0!==r?r:-1),n?(this.CURSOR=t,n):void 0):void 0}get(e){return this.node(e)}has(e){return this.node(e)!==c}del(e){var t;const r=this.node(e);if(!r)return;--this.LENGTH,this.heap.push(r.index),null===(t=this.index)||void 0===t||t.delete(r.key,r.index);const n=this.nodes;return n[r.prev].next=r.next,n[r.next].prev=r.prev,this.HEAD===r.index&&(this.HEAD=r.next),this.CURSOR===r.index&&(this.CURSOR=r.next),n[r.index]=c,r}delete(e,t){var r,n;return this.del(null!==(n=null===(r=this.find(e,t))||void 0===r?void 0:r.index)&&void 0!==n?n:-1)}insert(e,t,r){const n=this.HEAD;this.HEAD=r;const i=this.add(e,t);return 1!==this.length&&(this.HEAD=n),i}unshift(e,t){return this.add(e,t)}unshiftRotationally(e,t){if(0===this.length)return this.unshift(e,t);const r=this.last;return this.index&&!(0,o.equal)(r.key,e)&&(this.index.delete(r.key,r.index),this.index.set(e,r.index)),this.HEAD=r.index,this.CURSOR=r.index,r.key=e,r.value=t,r.index}shift(){const e=this.head;return e&&this.del(e.index)}push(e,t){return this.insert(e,t,this.HEAD)}pushRotationally(e,t){if(0===this.length)return this.push(e,t);const r=this.head;return this.index&&!(0,o.equal)(r.key,e)&&(this.index.delete(r.key,r.index),this.index.set(e,r.index)),this.HEAD=r.next,this.CURSOR=r.index,r.key=e,r.value=t,r.index}pop(){const e=this.last;return e&&this.del(e.index)}replace(e,t,r){const n=this.node(e);if(!n)return;this.index&&!(0,o.equal)(n.key,t)&&(this.index.delete(n.key,e),this.index.set(t,e));const i={index:n.index,key:n.key,value:n.value,next:n.next,prev:n.prev};return n.key=t,n.value=r,i}move(e,t){if(e===t)return!1;const r=this.node(e);if(!r)return!1;const n=this.node(t);if(!n)return!1;if(r.next===n.index)return!1;const i=this.nodes,s=i[n.prev],o=i[r.prev],c=i[r.next];return s.next=r.index,r.next=n.index,n.prev=r.index,r.prev=s.index,o.next=c.index,c.prev=o.index,!0}moveToHead(e){this.move(e,this.HEAD),this.HEAD=e}moveToLast(e){this.move(e,this.HEAD),this.HEAD=e===this.HEAD?this.head.next:this.HEAD}swap(e,t){if(e===t)return!1;const r=this.node(e);if(!r)return!1;const n=this.node(t);if(!n)return!1;const i=this.nodes[n.next];switch(this.move(n.index,r.index),this.move(r.index,i.index),this.HEAD){case r.index:this.HEAD=n.index;break;case n.index:this.HEAD=r.index}return!0}*[Symbol.iterator](){const e=this.nodes;for(let t=e[this.HEAD];t;)if(yield[t.key,t.value],t=e[t.next],(null==t?void 0:t.index)===this.HEAD)return}}r.List=u},{"../alias":4,"../compare":11,"../global":20,"../stack":92}],28:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./monad/maybe"),r)},{"./monad/maybe":36}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reduce=r.memoize=void 0;const n=e("./global"),i=e("./compare");r.memoize=function e(t,r=((...e)=>e[0]),i){if("object"==typeof r)return e(t,void 0,r);if(void 0===i)return e(t,r,new n.Map);let s=!1;return(...e)=>{const n=r(...e);let o=i.get(n);return void 0!==o||s&&i.has(n)||(o=t(...e),s||(s=void 0===o),i.set(n,o)),o}},r.reduce=function(e,t=((...e)=>e[0])){let r=[],n=[];return(...s)=>{const o=t(...s);return(0,i.equal)(r,o)||(r=o,n=e(...s)),n}}},{"./compare":11,"./global":20}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Applicative=void 0;const n=e("./functor"),i=e("../curry");class s extends n.Functor{}r.Applicative=s,function(e){e.ap=function e(t,r){return r?t.bind((e=>r.fmap((0,i.curry)(e)))):r=>e(t,r)}}(s=r.Applicative||(r.Applicative={}))},{"../curry":14,"./functor":33}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Right=r.Left=r.Either=void 0;const n=e("./monad"),i=e("../promise"),s=e("../noop");class o extends n.Monad{constructor(e){super(e)}fmap(e){return this.bind((t=>new a(e(t))))}ap(e){return o.ap(this,e)}bind(e){return new o((()=>{const t=this.evaluate();if(t instanceof c)return t;if(t instanceof a)return e(t.extract());if(t instanceof o)return t.bind(e);throw new TypeError(`Spica: Either: Invalid monad value: ${t}`)}))}join(){return this.bind((e=>e))}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let r;for(;;){const{value:e,done:n}=t.next(r);if(n)return e;const i=e.extract(s.noop,(e=>[e]));if(!i)return e;r=i[0]}}}r.Either=o,function(e){function t(e){return new a(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract((e=>i.AtomicPromise.resolve(new c(e))),(t=>i.AtomicPromise.resolve(t).then(e.Return))):t.reduce(((e,t)=>e.bind((e=>t.fmap((t=>[...e,t]))))),e.Return([]))}}(o=r.Either||(r.Either={}));class c extends o{constructor(e){super(u),this.value=e}bind(e){return this}extract(e){if(!e)throw this.value;return e(this.value)}}r.Left=c;class a extends o{constructor(e){super(u),this.value=e}bind(e){return new o((()=>e(this.extract())))}extract(e,t){return t?t(this.value):this.value}}function u(){throw new Error("Spica: Either: Invalid thunk call.")}r.Right=a},{"../noop":86,"../promise":88,"./monad":37}],32:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.Right=r.Left=r.Either=void 0;const o=s(e("./either.impl")),c=e("../noop");class a extends o.Either{constructor(){super(c.noop)}}r.Either=a,r.Left=function(e){return new o.Left(e)},r.Right=function(e){return new o.Right(e)}},{"../noop":86,"./either.impl":31}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Functor=void 0;const n=e("./lazy");class i extends n.Lazy{}r.Functor=i,function(e){e.fmap=function(e,t){return t?e.fmap(t):t=>e.fmap(t)}}(i=r.Functor||(r.Functor={}))},{"./lazy":34}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Lazy=void 0;r.Lazy=class{constructor(e){this.thunk=e,this.memory_=void 0}evaluate(){var e;return null!==(e=this.memory_)&&void 0!==e?e:this.memory_=this.thunk()}}},{}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Nothing=r.Just=r.Maybe=void 0;const n=e("./monadplus"),i=e("../promise"),s=e("../noop");class o extends n.MonadPlus{constructor(e){super(e)}fmap(e){return this.bind((t=>new c(e(t))))}ap(e){return o.ap(this,e)}bind(e){return new o((()=>{const t=this.evaluate();if(t instanceof c)return e(t.extract());if(t instanceof a)return t;if(t instanceof o)return t.bind(e);throw new TypeError(`Spica: Maybe: Invalid monad value: ${t}`)}))}guard(e){return e?this:o.mzero}join(){return this.bind((e=>e))}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let r;for(;;){const{value:e,done:n}=t.next(r);if(n)return e;const i=e.extract(s.noop,(e=>[e]));if(!i)return e;r=i[0]}}}r.Maybe=o,function(e){function t(e){return new c(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract((()=>i.AtomicPromise.resolve(e.mzero)),(t=>i.AtomicPromise.resolve(t).then(e.Return))):t.reduce(((e,t)=>e.bind((e=>t.fmap((t=>[...e,t]))))),e.Return([]))}}(o=r.Maybe||(r.Maybe={}));class c extends o{constructor(e){super(u),this.value=e}bind(e){return new o((()=>e(this.extract())))}extract(e,t){return t?t(this.value):this.value}}r.Just=c;class a extends o{constructor(){super(u)}bind(e){return this}extract(e){if(!e)throw void 0;return e()}}function u(){throw new Error("Spica: Maybe: Invalid thunk call.")}r.Nothing=a,function(e){e.mzero=new a,e.mplus=function(t,r){return new e((()=>t.fmap((()=>t)).extract((()=>r))))}}(o=r.Maybe||(r.Maybe={}))},{"../noop":86,"../promise":88,"./monadplus":38}],36:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.Nothing=r.Just=r.Maybe=void 0;const o=s(e("./maybe.impl")),c=e("../noop");class a extends o.Maybe{constructor(){super(c.noop)}}r.Maybe=a,r.Just=function(e){return new o.Just(e)},r.Nothing=o.Maybe.mzero},{"../noop":86,"./maybe.impl":35}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Monad=void 0;const n=e("./applicative");class i extends n.Applicative{}r.Monad=i,function(e){e.bind=function e(t,r){return r?t.bind(r):r=>e(t,r)}}(i=r.Monad||(r.Monad={}))},{"./applicative":30}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MonadPlus=void 0;const n=e("./monad");class i extends n.Monad{}r.MonadPlus=i,i=r.MonadPlus||(r.MonadPlus={})},{"./monad":37}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Sequence=void 0,e("./sequence/member/static/resume"),e("./sequence/member/static/from"),e("./sequence/member/static/cycle"),e("./sequence/member/static/random"),e("./sequence/member/static/concat"),e("./sequence/member/static/zip"),e("./sequence/member/static/difference"),e("./sequence/member/static/union"),e("./sequence/member/static/intersect"),e("./sequence/member/static/pure"),e("./sequence/member/static/return"),e("./sequence/member/static/sequence"),e("./sequence/member/static/mempty"),e("./sequence/member/static/mconcat"),e("./sequence/member/static/mappend"),e("./sequence/member/static/mzero"),e("./sequence/member/static/mplus"),e("./sequence/member/instance/extract"),e("./sequence/member/instance/iterate"),e("./sequence/member/instance/memoize"),e("./sequence/member/instance/reduce"),e("./sequence/member/instance/take"),e("./sequence/member/instance/drop"),e("./sequence/member/instance/takeWhile"),e("./sequence/member/instance/dropWhile"),e("./sequence/member/instance/takeUntil"),e("./sequence/member/instance/dropUntil"),e("./sequence/member/instance/sort"),e("./sequence/member/instance/unique"),e("./sequence/member/instance/fmap"),e("./sequence/member/instance/ap"),e("./sequence/member/instance/bind"),e("./sequence/member/instance/join"),e("./sequence/member/instance/mapM"),e("./sequence/member/instance/filterM"),e("./sequence/member/instance/map"),e("./sequence/member/instance/filter"),e("./sequence/member/instance/scanl"),e("./sequence/member/instance/foldr"),e("./sequence/member/instance/group"),e("./sequence/member/instance/inits"),e("./sequence/member/instance/tails"),e("./sequence/member/instance/segs"),e("./sequence/member/instance/subsequences"),e("./sequence/member/instance/permutations");var n=e("./sequence/core");Object.defineProperty(r,"Sequence",{enumerable:!0,get:function(){return n.Sequence}})},{"./sequence/core":40,"./sequence/member/instance/ap":41,"./sequence/member/instance/bind":42,"./sequence/member/instance/drop":43,"./sequence/member/instance/dropUntil":44,"./sequence/member/instance/dropWhile":45,"./sequence/member/instance/extract":46,"./sequence/member/instance/filter":47,"./sequence/member/instance/filterM":48,"./sequence/member/instance/fmap":49,"./sequence/member/instance/foldr":50,"./sequence/member/instance/group":51,"./sequence/member/instance/inits":52,"./sequence/member/instance/iterate":53,"./sequence/member/instance/join":54,"./sequence/member/instance/map":55,"./sequence/member/instance/mapM":56,"./sequence/member/instance/memoize":57,"./sequence/member/instance/permutations":58,"./sequence/member/instance/reduce":59,"./sequence/member/instance/scanl":60,"./sequence/member/instance/segs":61,"./sequence/member/instance/sort":62,"./sequence/member/instance/subsequences":63,"./sequence/member/instance/tails":64,"./sequence/member/instance/take":65,"./sequence/member/instance/takeUntil":66,"./sequence/member/instance/takeWhile":67,"./sequence/member/instance/unique":68,"./sequence/member/static/concat":69,"./sequence/member/static/cycle":70,"./sequence/member/static/difference":71,"./sequence/member/static/from":72,"./sequence/member/static/intersect":73,"./sequence/member/static/mappend":74,"./sequence/member/static/mconcat":75,"./sequence/member/static/mempty":76,"./sequence/member/static/mplus":77,"./sequence/member/static/mzero":78,"./sequence/member/static/pure":79,"./sequence/member/static/random":80,"./sequence/member/static/resume":81,"./sequence/member/static/return":82,"./sequence/member/static/sequence":83,"./sequence/member/static/union":84,"./sequence/member/static/zip":85}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Sequence=void 0;const n=e("../monadplus");class i extends n.MonadPlus{constructor(e){super(s),this.cons=e}[Symbol.iterator](){let e=()=>this.iterate();return{next(){const t=e();return e=i.Thunk.iterator(t),{done:!i.isIterable(t),value:i.Thunk.value(t)}}}}}function s(){throw new Error("Spica: Sequence: Invalid thunk call.")}r.Sequence=i,i=r.Sequence||(r.Sequence={}),function(e){let t,r,n,i;!function(t){t.cons=function(t,r){switch(arguments.length){case 0:return[];case 1:return[t];case 2:return[t,r];default:throw e.Exception.invalidConsError(arguments)}}}(t=e.Data||(e.Data={})),function(e){e.value=function(e){return e[0]},e.iterator=function(e){return e[1]},e.index=function(e){return e[2]}}(r=e.Thunk||(e.Thunk={})),function(t){t.done=()=>[void 0,t.done,-1],t.when=function t(n,i,s){return e.isIterable(n)?s(n,(()=>t(r.iterator(n)(),i,s))):i(n)}}(n=e.Iterator||(e.Iterator={})),e.isIterable=function(e){return r.iterator(e)!==n.done},function(e){e.invalidConsError=function(e){return console.error(e,e.length,e[0],e[1]),new TypeError("Spica: Sequence: Invalid parameters of cons.")},e.invalidDataError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid data.")},e.invalidThunkError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid thunk.")}}(i=e.Exception||(e.Exception={}))}(i=r.Sequence||(r.Sequence={}))},{"../monadplus":38}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{ap(e){return n.Sequence.ap(this,e)}})},{"../../../../helper/compose":21,"../../core":40}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{bind(e){return n.Sequence.concat(this.fmap(e))}})},{"../../../../helper/compose":21,"../../core":40}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{drop(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),(()=>r()),((t,i)=>n.Sequence.Thunk.index(t)<e?i():r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{dropUntil(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),(()=>r()),((t,i)=>e(n.Sequence.Thunk.value(t))?i():r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{dropWhile(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),(()=>r()),((t,i)=>e(n.Sequence.Thunk.value(t))?i():r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],46:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{extract(){const e=[];let t=()=>this.iterate();for(;;){const r=t();if(!n.Sequence.isIterable(r))return e;e.push(n.Sequence.Thunk.value(r)),t=n.Sequence.Thunk.iterator(r)}}})},{"../../../../helper/compose":21,"../../core":40}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{filter(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),(()=>r()),((t,i)=>e(n.Sequence.Thunk.value(t),n.Sequence.Thunk.index(t))?r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t)):i()))))}})},{"../../../../helper/compose":21,"../../core":40}],48:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{filterM(e){return n.Sequence.from([0]).bind((()=>{const t=this.extract();if(0===t.length)return n.Sequence.from([[]]);{const r=t.shift();return e(r).bind((i=>i?0===t.length?n.Sequence.from([[r]]):n.Sequence.from(t).filterM(e).fmap((e=>[r,...e])):0===t.length?n.Sequence.from([[]]):n.Sequence.from(t).filterM(e)))}}))}})},{"../../../../helper/compose":21,"../../core":40}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{fmap(e){return new n.Sequence(((t=(()=>this.iterate()))=>n.Sequence.Iterator.when(t(),(()=>n.Sequence.Data.cons()),(t=>n.Sequence.Data.cons(e(n.Sequence.Thunk.value(t)),n.Sequence.Thunk.iterator(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],50:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{foldr(e,t){return new n.Sequence(((r=(()=>this.reduce().iterate()))=>n.Sequence.Iterator.when(r(),(()=>n.Sequence.Data.cons(t)),(r=>n.Sequence.Data.cons(e(n.Sequence.Thunk.value(r),n.Sequence.resume(n.Sequence.Thunk.iterator(r)).foldr(e,t))))))).bind((e=>e))}})},{"../../../../helper/compose":21,"../../core":40}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{group(e){return new n.Sequence((([t,r]=[()=>this.iterate(),[]],i)=>n.Sequence.Iterator.when(t(),(()=>0===r.length?i():i(r)),((t,s)=>0===r.length||e(r[0],n.Sequence.Thunk.value(t))?(r.push(n.Sequence.Thunk.value(t)),s()):i(r,[n.Sequence.Thunk.iterator(t),[n.Sequence.Thunk.value(t)]])))))}})},{"../../../../helper/compose":21,"../../core":40}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{inits(){return n.Sequence.mappend(n.Sequence.from([[]]),this.scanl(((e,t)=>[...e,t]),[]).dropWhile((e=>0===e.length)))}})},{"../../../../helper/compose":21,"../../core":40}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{iterate(){return this.iterate_()}iterate_(e,t=0){const r=this.cons(e,n.Sequence.Data.cons);switch(r.length){case 0:return[void 0,n.Sequence.Iterator.done,-1];case 1:return[r[0],()=>n.Sequence.Iterator.done(),t];case 2:return[r[0],()=>this.iterate_(r[1],t+1),t];default:throw n.Sequence.Exception.invalidDataError(r)}}})},{"../../../../helper/compose":21,"../../core":40}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{join(){return n.Sequence.concat(this)}})},{"../../../../helper/compose":21,"../../core":40}],55:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{map(e){return new n.Sequence(((t=(()=>this.iterate()))=>n.Sequence.Iterator.when(t(),(()=>n.Sequence.Data.cons()),(t=>n.Sequence.Data.cons(e(n.Sequence.Thunk.value(t),n.Sequence.Thunk.index(t)),n.Sequence.Thunk.iterator(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{mapM(e){return n.Sequence.from([0]).bind((()=>{const t=this.extract();if(0===t.length)return n.Sequence.mempty;{const r=t.shift();return e(r).bind((r=>0===t.length?n.Sequence.from([[r]]):n.Sequence.from(t).mapM(e).fmap((e=>[r,...e]))))}}))}})},{"../../../../helper/compose":21,"../../core":40}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../../../global"),i=e("../../core"),s=e("../../../../helper/compose"),o=(0,e("../../../../memoize").memoize)((e=>new n.Map));(0,s.compose)(i.Sequence,class extends i.Sequence{memoize(){return new i.Sequence((([e,t]=[0,o(this)],r)=>i.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?i.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),(()=>r()),(n=>r(i.Sequence.Thunk.value(n),[e+1,t])))))}})},{"../../../../global":20,"../../../../helper/compose":21,"../../../../memoize":29,"../../core":40}],58:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");function i(e,t){return n.Sequence.Iterator.when(e.iterate(),(()=>n.Sequence.mempty),(e=>new n.Sequence(((r,s)=>n.Sequence.Iterator.when(e,(()=>s()),(e=>{const r=n.Sequence.Thunk.value(e),o=n.Sequence.resume(n.Sequence.Thunk.iterator(e)).memoize();return s(t.permutations().foldr(((e,t)=>function(e,t){return c((e=>e),e,t)[1]}(n.Sequence.from(e),t)),i(o,n.Sequence.mappend(n.Sequence.from([r]),t))));function c(e,t,i){return n.Sequence.Iterator.when(t.iterate(),(()=>[o,i]),(t=>{const s=n.Sequence.Thunk.value(t),[o,a]=c((t=>e(n.Sequence.mappend(n.Sequence.from([s]),t))),n.Sequence.resume(n.Sequence.Thunk.iterator(t)),i);return[n.Sequence.mappend(n.Sequence.from([s]),o),n.Sequence.mappend(n.Sequence.from([e(n.Sequence.mappend(n.Sequence.from([r]),n.Sequence.mappend(n.Sequence.from([s]),o))).extract()]),a)]}))}})))).bind((e=>e))))}(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{permutations(){return n.Sequence.from([0]).bind((()=>{const e=this.extract();return 0===e.length?n.Sequence.mempty:n.Sequence.from([e])})).bind((e=>n.Sequence.mappend(n.Sequence.from([e]),i(n.Sequence.from(e),n.Sequence.mempty))))}})},{"../../../../helper/compose":21,"../../core":40}],59:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../../../global"),i=e("../../core");(0,e("../../../../helper/compose").compose)(i.Sequence,class extends i.Sequence{reduce(){return new i.Sequence((([e,t]=[0,new n.Map],r)=>i.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?i.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),(()=>r()),(n=>r(i.Sequence.Thunk.value(n),[e+1,t])))))}})},{"../../../../global":20,"../../../../helper/compose":21,"../../core":40}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{scanl(e,t){return new n.Sequence((([r,i,s]=[t,()=>this.iterate(),0])=>n.Sequence.Iterator.when(i(),(()=>0===s?n.Sequence.Data.cons(t):n.Sequence.Data.cons()),(t=>n.Sequence.Data.cons(r=e(r,n.Sequence.Thunk.value(t)),[r,n.Sequence.Thunk.iterator(t),n.Sequence.Thunk.index(t)+1])))))}})},{"../../../../helper/compose":21,"../../core":40}],61:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{segs(){return n.Sequence.mappend(this.foldr(((e,t)=>t.take(1).bind((r=>n.Sequence.mappend(n.Sequence.from([n.Sequence.mappend(n.Sequence.from([[e]]),n.Sequence.from(r).map((t=>[e,...t])))]),t)))),n.Sequence.from([n.Sequence.from([])])).bind((e=>e)),n.Sequence.from([[]]))}})},{"../../../../helper/compose":21,"../../core":40}],62:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{sort(e){return n.Sequence.from(this.extract().sort(e))}})},{"../../../../helper/compose":21,"../../core":40}],63:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");function i(e){return n.Sequence.Iterator.when(e.iterate(),(()=>n.Sequence.mempty),(e=>n.Sequence.mappend(n.Sequence.from([[n.Sequence.Thunk.value(e)]]),new n.Sequence(((t,r)=>n.Sequence.Iterator.when(e,(()=>r()),(e=>r(i(n.Sequence.resume(n.Sequence.Thunk.iterator(e))).foldr(((t,r)=>n.Sequence.mappend(n.Sequence.mappend(n.Sequence.from([t]),n.Sequence.from([[n.Sequence.Thunk.value(e),...t]])),r)),n.Sequence.mempty)))))).bind((e=>e)))))}(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{subsequences(){return n.Sequence.mappend(n.Sequence.from([[]]),n.Sequence.from([0]).bind((()=>i(this))))}})},{"../../../../helper/compose":21,"../../core":40}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{tails(){return n.Sequence.mappend(n.Sequence.from(this.extract().map(((e,t,r)=>r.slice(t)))),n.Sequence.from([[]]))}})},{"../../../../helper/compose":21,"../../core":40}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{take(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(e>0?t():n.Sequence.Iterator.done(),(()=>r()),(t=>n.Sequence.Thunk.index(t)+1<e?r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t)):r(n.Sequence.Thunk.value(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{takeUntil(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),(()=>r()),(t=>e(n.Sequence.Thunk.value(t))?r(n.Sequence.Thunk.value(t)):r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))))}})},{"../../../../helper/compose":21,"../../core":40}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{takeWhile(e){return new n.Sequence(((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),(()=>r()),(t=>e(n.Sequence.Thunk.value(t))?r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t)):r()))))}})},{"../../../../helper/compose":21,"../../core":40}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{unique(){const e=new Set;return this.filter((t=>!e.has(t)&&!!e.add(t)))}})},{"../../../../helper/compose":21,"../../core":40}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static concat(e){return new n.Sequence((([t,r]=[()=>e.iterate(),n.Sequence.Iterator.done],i)=>n.Sequence.Iterator.when(t(),(()=>i()),((e,t)=>(r=r===n.Sequence.Iterator.done?()=>n.Sequence.Thunk.value(e).iterate():r,n.Sequence.Iterator.when(r(),(()=>(r=n.Sequence.Iterator.done,t())),(t=>i(n.Sequence.Thunk.value(t),[()=>e,n.Sequence.Thunk.iterator(t)]))))))))}})},{"../../../../helper/compose":21,"../../core":40}],70:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static cycle(e){return new n.Sequence((function t([r,n]=[e[Symbol.iterator](),0],i){const s=r.next();return s.done?t([e[Symbol.iterator](),n+1],i):i(s.value,[r,n+1])})).reduce()}})},{"../../../../helper/compose":21,"../../core":40}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static difference(e,t,r){return new n.Sequence((([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>n.Sequence.Iterator.when(i(),(()=>n.Sequence.Iterator.when(s(),(()=>o()),(e=>o(n.Sequence.Thunk.value(e),[n.Sequence.Iterator.done,n.Sequence.Thunk.iterator(e)])))),((e,t)=>n.Sequence.Iterator.when(s(),(()=>o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Iterator.done])),(i=>{const c=r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(i));return c<0?o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),()=>i]):c>0?o(n.Sequence.Thunk.value(i),[()=>e,n.Sequence.Thunk.iterator(i)]):(s=()=>n.Sequence.Thunk.iterator(i)(),t())}))))))}})},{"../../../../helper/compose":21,"../../core":40}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static from(e){return new n.Sequence((([t,r]=[e[Symbol.iterator](),0],n)=>{const i=t.next();return i.done?n():n(i.value,[t,r+1])})).reduce()}})},{"../../../../helper/compose":21,"../../core":40}],73:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static intersect(e,t,r){return new n.Sequence((([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>n.Sequence.Iterator.when(i(),(()=>o()),((e,t)=>n.Sequence.Iterator.when(s(),(()=>o()),((i,c)=>{const a=r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(i));return a<0?(s=()=>i,t()):a>0?c():o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Thunk.iterator(i)])}))))))}})},{"../../../../helper/compose":21,"../../core":40}],74:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static mappend(e,t){return n.Sequence.mconcat([e,t])}})},{"../../../../helper/compose":21,"../../core":40}],75:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static mconcat(e){return[...e].reduce(((e,t)=>function(e,t){return new n.Sequence((([r,i]=[()=>e.iterate(),()=>t.iterate()],s)=>n.Sequence.Iterator.when(r(),(()=>n.Sequence.Iterator.when(i(),(()=>s()),(e=>s(n.Sequence.Thunk.value(e),[n.Sequence.Iterator.done,n.Sequence.Thunk.iterator(e)])))),(e=>s(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),i])))))}(e,t)),n.Sequence.mempty)}})},{"../../../../helper/compose":21,"../../core":40}],76:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../core");(0,e("../../../../helper/compose").compose)(i.Sequence,((n=class extends i.Sequence{}).mempty=new i.Sequence(((e,t)=>t())),n))},{"../../../../helper/compose":21,"../../core":40}],77:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../core");(0,e("../../../../helper/compose").compose)(i.Sequence,((n=class extends i.Sequence{}).mplus=i.Sequence.mappend,n))},{"../../../../helper/compose":21,"../../core":40}],78:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../core");(0,e("../../../../helper/compose").compose)(i.Sequence,((n=class extends i.Sequence{}).mzero=i.Sequence.mempty,n))},{"../../../../helper/compose":21,"../../core":40}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static pure(e){return new n.Sequence(((t,r)=>r(e)))}})},{"../../../../helper/compose":21,"../../core":40}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../../../alias"),i=e("../../core");(0,e("../../../../helper/compose").compose)(i.Sequence,class extends i.Sequence{static random(e=(()=>(0,n.random)())){return"function"==typeof e?i.Sequence.from(new i.Sequence(((t,r)=>r(e(),t)))):this.random().map((t=>e[(0,n.floor)(t*e.length)]))}})},{"../../../../alias":4,"../../../../helper/compose":21,"../../core":40}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static resume(e){return new n.Sequence(((t=e,r)=>n.Sequence.Iterator.when(t(),(()=>r()),(e=>r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.iterator(e))))))}})},{"../../../../helper/compose":21,"../../core":40}],82:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static Return(e){return new n.Sequence(((t,r)=>r(e)))}})},{"../../../../helper/compose":21,"../../core":40}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static sequence(e){return e.reduce(((e,t)=>e.fmap((e=>n.Sequence.mappend(e,t)))),n.Sequence.Return(n.Sequence.from([])))}})},{"../../../../helper/compose":21,"../../core":40}],84:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static union(e,t,r){return new n.Sequence((([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>n.Sequence.Iterator.when(i(),(()=>n.Sequence.Iterator.when(s(),(()=>o()),(e=>o(n.Sequence.Thunk.value(e),[n.Sequence.Iterator.done,n.Sequence.Thunk.iterator(e)])))),(e=>n.Sequence.Iterator.when(s(),(()=>o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Iterator.done])),(t=>{const i=r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(t));return i<0?o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),()=>t]):i>0?o(n.Sequence.Thunk.value(t),[()=>e,n.Sequence.Thunk.iterator(t)]):o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Thunk.iterator(t)])}))))))}})},{"../../../../helper/compose":21,"../../core":40}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");(0,e("../../../../helper/compose").compose)(n.Sequence,class extends n.Sequence{static zip(e,t){return new n.Sequence((([r,i]=[()=>e.iterate(),()=>t.iterate()],s)=>n.Sequence.Iterator.when(r(),(()=>s()),(e=>n.Sequence.Iterator.when(i(),(()=>s()),(t=>s([n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(t)],[n.Sequence.Thunk.iterator(e),n.Sequence.Thunk.iterator(t)])))))))}})},{"../../../../helper/compose":21,"../../core":40}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.noop=void 0,r.noop=function(){}},{}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Observation=void 0;const n=e("./global"),i=e("./ixlist"),s=e("./assign"),o=e("./function"),c=e("./array"),a=e("./exception");class u{constructor(e,t){this.parent=e,this.index=t,this.children=new i.List(new n.Map),this.monitors=[],this.subscribers=[]}}function l({monitors:e,subscribers:t,children:r}){for(let e=r.last,t=0;e&&t<r.length;(e=r.node(e.prev))&&++t)if(l(e.value)){if(e=r.node(r.del(e.index).next),!e)break;--t}return(0,c.splice)(t,0),0===e.length}r.Observation=class{constructor(e={}){this.id=0,this.node=new u(void 0,void 0),this.settings={limit:10,cleanup:!1},this.relaies=new n.WeakSet,(0,s.extend)(this.settings,e)}monitor(e,t,r={}){if("function"!=typeof t)throw new n.Error(`Spica: Observation: Invalid listener: ${t}`);const{monitors:i}=this.seekNode(e,0);if(i.length===this.settings.limit)throw new n.Error("Spica: Observation: Exceeded max listener limit.");if(this.id===n.Number.MAX_SAFE_INTEGER)throw new n.Error("Spica: Observation: Max listener ID reached max safe integer.");const s={id:++this.id,type:0,namespace:e,listener:t,options:r};return i.push(s),(0,o.singleton)((()=>{this.off(e,s)}))}on(e,t,r={}){if("function"!=typeof t)throw new n.Error(`Spica: Observation: Invalid listener: ${t}`);const{subscribers:i}=this.seekNode(e,0);if(i.length===this.settings.limit)throw new n.Error("Spica: Observation: Exceeded max listener limit.");if(this.id===n.Number.MAX_SAFE_INTEGER)throw new n.Error("Spica: Observation: Max listener ID reached max safe integer.");const s={id:++this.id,type:1,namespace:e,listener:t,options:r};return i.push(s),(0,o.singleton)((()=>{this.off(e,s)}))}once(e,t){return this.on(e,t,{once:!0})}off(e,t){const r=this.seekNode(e,1);if(r)switch(typeof t){case"object":{const e=0===t.type?r.monitors:r.subscribers;if(0===e.length||t.id<e[0].id||t.id>e[e.length-1].id)return;return void(0,c.splice)(e,e.indexOf(t),1)}case"function":{const e=r.subscribers;return void(0,c.splice)(e,e.findIndex((e=>e.listener===t)),1)}case"undefined":return void l(r)}}emit(e,t,r){this.drain(e,t,r)}reflect(e,t){let r;return this.emit(e,t,((e,t)=>r=t)),r}relay(e){if(this.relaies.has(e))throw new n.Error("Spica: Observation: Relay source is already registered.");return this.relaies.add(e),e.monitor([],((e,t)=>{this.emit(t,e)}))}refs(e){const t=this.seekNode(e,1);return t?(0,c.push)(this.refsBelow(t,0),this.refsBelow(t,1)).reduce(((e,t)=>(0,c.push)(e,t)),[]):[]}drain(e,t,r){const n=this.seekNode(e,1),i=[],s=n?this.refsBelow(n,1):[];for(let n=0;n<s.length;++n){const o=s[n];if(0!==o.length)for(let n=0,s=o[o.length-1].id;n<o.length&&o[n].id<=s;++n){const s=o[n];s.options.once&&this.off(s.namespace,s);try{const n=s.listener(t,e);r&&i.push(n)}catch(e){(0,a.causeAsyncException)(e)}for(n=n<o.length?n:o.length-1;n>=0&&o[n].id>s.id;--n);}}const o=this.refsAbove(n||this.seekNode(e,2),0);for(let r=0;r<o.length;++r){const n=o[r];if(0!==n.length)for(let r=0,i=n[n.length-1].id;r<n.length&&n[r].id<=i;++r){const i=n[r];i.options.once&&this.off(i.namespace,i);try{i.listener(t,e)}catch(e){(0,a.causeAsyncException)(e)}for(r=r<n.length?r:n.length-1;r>=0&&n[r].id>i.id;--r);}}if(r)try{r(t,i)}catch(e){(0,a.causeAsyncException)(e)}}refsAbove({parent:e,monitors:t,subscribers:r},n){const i=0===n?[t]:[r];for(;e;)0===n?i.push(e.monitors):i.push(e.subscribers),e=e.parent;return i}refsBelow(e,t){return this.refsBelow_(e,t,[])[0]}refsBelow_({monitors:e,subscribers:t,children:r},n,i){0===n?i.push(e):i.push(t);let s=0;for(let e=r.last,t=0;e&&t<r.length;(e=r.node(e.prev))&&++t){const o=this.refsBelow_(e.value,n,i)[1];if(s+=o,0===o&&this.settings.cleanup){if(e=r.node(r.del(e.index).next),!e)break;--t}}return[i,e.length+t.length+s]}seekNode(e,t){var r;let n=this.node;for(let i=0;i<e.length;++i){const s=e[i],{children:o}=n;let c=null===(r=o.find(s))||void 0===r?void 0:r.value;if(!c){switch(t){case 1:return;case 2:return n}c=new u(n,s),o.add(s,c)}n=c}return n}}},{"./array":5,"./assign":6,"./exception":16,"./function":18,"./global":20,"./ixlist":24}],88:[function(e,t,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.never=r.isPromiseLike=r.Internal=r.AtomicPromise=void 0;const s=e("./global"),o=e("./alias"),c=e("./noop"),a=Symbol.for("spica/promise::internal");class u{constructor(e){this[n]="Promise",this[i]=new l;try{e((e=>{this[a].resolve(e)}),(e=>{this[a].reject(e)}))}catch(e){this[a].reject(e)}}static get[Symbol.species](){return u}static all(e){return new u(((t,r)=>{const n=(0,o.isArray)(e)?e:[...e],i=(0,s.Array)(n.length);let c=!1,u=0;for(let e=0;!c&&e<n.length;++e){const s=n[e];if(p(s)){if(f(s)){const{status:t}=s[a];switch(t.state){case 2:i[e]=t.value,++u;continue;case 3:return r(t.reason)}}s.then((r=>{i[e]=r,++u,u===n.length&&t(i)}),(e=>{r(e),c=!0}))}else i[e]=s,++u}u===n.length&&t(i)}))}static race(e){return new u(((t,r)=>{const n=(0,o.isArray)(e)?e:[...e];for(let e=0;e<n.length;++e){const i=n[e];if(!p(i))return t(i);if(f(i)){const{status:e}=i[a];switch(e.state){case 2:return t(e.value);case 3:return r(e.reason)}}}let i=!1;for(let e=0;!i&&e<n.length;++e){n[e].then((e=>{t(e),i=!0}),(e=>{r(e),i=!0}))}}))}static allSettled(e){return new u((t=>{const r=(0,o.isArray)(e)?e:[...e],n=(0,s.Array)(r.length);let i=0;for(let e=0;e<r.length;++e){const s=r[e];if(p(s)){if(f(s)){const{status:t}=s[a];switch(t.state){case 2:n[e]={status:"fulfilled",value:t.value},++i;continue;case 3:n[e]={status:"rejected",reason:t.reason},++i;continue}}s.then((s=>{n[e]={status:"fulfilled",value:s},++i,i===r.length&&t(n)}),(s=>{n[e]={status:"rejected",reason:s},++i,i===r.length&&t(n)}))}else n[e]={status:"fulfilled",value:s},++i}i===r.length&&t(n)}))}static any(e){return new u(((t,r)=>{const n=(0,o.isArray)(e)?e:[...e],i=(0,s.Array)(n.length);let c=!1,u=0;for(let e=0;!c&&e<n.length;++e){const s=n[e];if(!p(s))return t(s);if(f(s)){const{status:r}=s[a];switch(r.state){case 2:return t(r.value);case 3:i[e]=r.reason,++u;continue}}s.then((e=>{t(e),c=!0}),(t=>{i[e]=t,++u,u===n.length&&r(new AggregateError(i,"All promises were rejected"))}))}u===n.length&&r(new AggregateError(i,"All promises were rejected"))}))}static resolve(e){return new u((t=>t(e)))}static reject(e){return new u(((t,r)=>r(e)))}then(e,t){return new u(((r,n)=>this[a].then(r,n,e,t)))}catch(e){return this.then(void 0,e)}finally(e){return this.then(e,e).then((()=>this))}}r.AtomicPromise=u,n=Symbol.toStringTag,i=a;class l{constructor(){this.status={state:0},this.fulfillReactions=[],this.rejectReactions=[]}get isPending(){return 0===this.status.state}resolve(e){if(0===this.status.state){if(!p(e))return this.status={state:2,value:e},this.resume();if(f(e)){const t=e[a];switch(t.status.state){case 2:case 3:return this.status=t.status,this.resume();default:return t.then((()=>(this.status=t.status,this.resume())),(()=>(this.status=t.status,this.resume())))}}this.status={state:1,promise:e},e.then((e=>{this.status={state:2,value:e},this.resume()}),(e=>{this.status={state:3,reason:e},this.resume()}))}}reject(e){if(0===this.status.state)return this.status={state:3,reason:e},this.resume()}then(e,t,r,n){const{status:i,fulfillReactions:s,rejectReactions:o}=this;switch(i.state){case 2:if(0!==s.length)break;return d(e,t,e,r,i.value);case 3:if(0!==o.length)break;return d(e,t,t,n,i.reason)}s.push([e,t,e,r]),o.push([e,t,t,n])}resume(){const{status:e,fulfillReactions:t,rejectReactions:r}=this;switch(e.state){case 0:case 1:return;case 2:if(0!==r.length&&(this.rejectReactions=[]),0===t.length)return;return h(t,e.value),void(this.fulfillReactions=[]);case 3:if(0!==t.length&&(this.fulfillReactions=[]),0===r.length)return;return h(r,e.reason),void(this.rejectReactions=[])}}}function h(e,t){for(let r=0;r<e.length;++r){const n=e[r];d(n[0],n[1],n[2],n[3],t)}}function d(e,t,r,n,i){if(!n)return r(i);try{e(n(i))}catch(e){t(e)}}function p(e){return null!==e&&"object"==typeof e&&"function"==typeof e.then}function f(e){return a in e}r.Internal=l,r.isPromiseLike=p,r.never=new class e extends Promise{static get[Symbol.species](){return e}constructor(){super(c.noop)}then(){return this}catch(){return this}finally(){return this}}},{"./alias":4,"./global":20,"./noop":86}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._match=r._expand=r.compare=r.router=void 0;const n=e("./alias"),i=e("./url"),s=e("./sequence"),o=e("./curry"),c=e("./flip"),a=e("./memoize");function u(e,t){const r=/\/|[^/]+\/?/g,n=/\/$/;return s.Sequence.zip(s.Sequence.from(l(e)),s.Sequence.cycle([t])).map((([e,t])=>[e.match(r)||[],e.match(n)?t.match(r)||[]:t.replace(n,"").match(r)||[]])).filter((([e,t])=>e.length<=t.length&&0===s.Sequence.zip(s.Sequence.from(e),s.Sequence.from(t)).dropWhile((([e,t])=>h(e,t))).take(1).extract().length)).take(1).extract().length>0}r.router=function(e){return t=>{const{path:r,pathname:a}=new i.URL((0,i.standardize)(t,window.location.href));return s.Sequence.from((0,n.ObjectKeys)(e).filter((e=>"/"===e[0])).sort().reverse()).filter((0,o.curry)((0,c.flip)(u))(a)).map((t=>e[t])).take(1).extract().pop().call(e,r)}},r.compare=u;const l=(0,a.memoize)((e=>{if(e.match(/\*\*|[\[\]]/))throw new Error(`Invalid pattern: ${e}`);return""===e?[e]:s.Sequence.from(e.match(/{[^{}]*}|.[^{]*/g)).map((e=>e.match(/^{[^{}]*}$/)?e.slice(1,-1).split(","):[e])).mapM(s.Sequence.from).map((e=>e.join(""))).bind((t=>t===e?s.Sequence.from([t]):s.Sequence.from(l(t)))).unique().extract()}));r._expand=l;const h=(0,a.memoize)(((e,t)=>("."!==t[0]||![..."?*"].includes(e[0]))&&function e(t,r){const[n="",...i]=[...t],[o="",...c]=[...r];switch(n){case"":return""===o;case"?":return""!==o&&"/"!==o&&e(i.join(""),c.join(""));case"*":return"/"===o?e(i.join(""),r):s.Sequence.zip(s.Sequence.cycle([i.join("")]),s.Sequence.from(r).tails().map((e=>e.join("")))).filter((([t,r])=>e(t,r))).take(1).extract().length>0;default:return o===n&&e(i.join(""),c.join(""))}}(function e(t){const r=t.replace(/\*(\?+)\*?/g,"$1*");return r===t?r:e(r)}(e),t)),((e,t)=>`${e}\n${t}`));r._match=h},{"./alias":4,"./curry":14,"./flip":17,"./memoize":29,"./sequence":90,"./url":98}],90:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./monad/sequence"),r)},{"./monad/sequence":39}],91:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.sqid=void 0;const n=e("./global"),i="0".repeat(15);let s=0;r.sqid=function e(t){if(0===arguments.length){if(s===n.Number.MAX_SAFE_INTEGER)throw new TypeError("Spica: sqid: sqid reached max safe integer.");return e(++s)}if("number"!=typeof t)throw new TypeError(`Spica: sqid: A parameter value must be a number: ${t}`);if(t>=0==!1)throw new TypeError(`Spica: sqid: A parameter value must be a positive number: ${t}`);if(t%1!=0)throw new TypeError(`Spica: sqid: A parameter value must be an integer: ${t}`);return(i+t).slice(-16)}},{"./global":20}],92:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Stack=void 0;const n=void 0;class i{constructor(){this.list=n,this.length=0}push(e){const t=this.list,r=null==t?void 0:t[0];++this.length,r&&100!==r.length?r.push(e):this.list=[[e],t]}pop(){const e=this.list;if(e===n)return;const t=e[0];if(--this.length,1!==t.length)return t.pop();const r=t[0];return this.list=e[1],e[1]=n,r}clear(){this.list=n}isEmpty(){return this.list===n}peek(){var e;return null===(e=this.list)||void 0===e?void 0:e[0][0]}*[Symbol.iterator](){for(;!this.isEmpty();)yield this.pop()}}r.Stack=i},{}],93:[function(e,t,r){(function(t){(function(){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.Supervisor=void 0;const i=e("./global"),s=e("./alias"),o=e("./clock"),c=e("./coroutine"),a=e("./promise"),u=e("./future"),l=e("./observer"),h=e("./array"),d=e("./assign"),p=e("./sqid"),f=e("./exception"),m=e("./noop");class v extends c.Coroutine{constructor(e={}){if(super((async function*(){return this.state}),{delay:!1}),this.state=new u.AtomicFuture,this.id=(0,p.sqid)(),this.settings={name:"",capacity:i.Infinity,timeout:i.Infinity,destructor:m.noop,scheduler:o.tick,resource:10},this.workers=new i.Map,this.alive=!0,this.available=!0,this[n]={ask:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},recv:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},send:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},connect:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)}},this.scheduled=!1,this.messages=[],(0,d.extend)(this.settings,e),this.name=this.settings.name,this.constructor===v)throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot instantiate abstract classes.`);this.constructor.instances.add(this)}static get instances(){return this.hasOwnProperty("instances_")?this.instances_:this.instances_=new i.Set}static get status(){if(this.hasOwnProperty("status_"))return this.status_;const{instances:e}=this;return this.status_={get instances(){return e.size},get processes(){return[...e].reduce(((e,t)=>e+t.workers.size),0)}}}static clear(e){for(;this.instances.size>0;)for(const t of this.instances)t.terminate(e)}destructor(e){var t;for(this.available=!1,this.clear(e),(0,s.ObjectFreeze)(this.workers);this.messages.length>0;){const[e,r,,,n]=this.messages.shift(),s="string"==typeof e?e:e[i.Symbol.iterator]().next().value;n&&(0,i.clearTimeout)(n),null===(t=this.events_)||void 0===t||t.loss.emit([s],[s,r])}this.alive=!1,this.constructor.instances.delete(this),(0,s.ObjectFreeze)(this),this.settings.destructor(e),this.state.bind(void 0===e?void 0:a.AtomicPromise.reject(e))}get events(){var e;return null!==(e=this.events_)&&void 0!==e?e:this.events_={init:new l.Observation,loss:new l.Observation,exit:new l.Observation}}throwErrorIfNotAvailable(){if(!this.available)throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: A supervisor is already terminated.`)}register(e,t,r){if(r=r,this.throwErrorIfNotAvailable(),(0,c.isCoroutine)(t)){const n=t[t.constructor.port],i={init:e=>e,main:(e,t,r)=>n.ask(e).then((({value:e,done:n})=>n&&void r()||[e,t])),exit:e=>{t[t.constructor.terminate](e)}};this.constructor.standalone.add(i);const s=this.register(e,i,r);return t.catch(s),s}if(function(e){return"AsyncGeneratorFunction"===e[i.Symbol.toStringTag]}(t)){let n;return this.register(e,{init:(e,r)=>(n=t(e,r),n.next().catch(r),e),main:(e,t,r)=>a.AtomicPromise.resolve(n.next(e)).then((({value:e,done:n})=>n&&void r()||[e,t])),exit:m.noop},r)}if("function"==typeof t){if(function(e){return"GeneratorFunction"===e[i.Symbol.toStringTag]}(t)){let n;return this.register(e,{init:(e,r)=>(n=t(e,r),n.next(),e),main:(e,t,r)=>{const{value:i,done:s}=n.next(e);return s&&r(),[i,t]},exit:m.noop},r)}return this.register(e,{init:e=>e,main:t,exit:m.noop},r)}if(this.workers.has(e))throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}/${e}>: Cannot register a process multiply with the same name.`);this.schedule();const n=new y(e,t,r,this,(()=>{this.schedule()}),this.constructor.standalone.has(t),this.events_,(()=>this.workers.get(e)===n&&void this.workers.delete(e)));return this.workers.set(e,n),n.terminate}call(e,t,r=this.settings.timeout,n=this.settings.timeout){var s;if("function"!=typeof r)return new a.AtomicPromise(((n,i)=>{this.call(e,t,((e,t)=>t?i(t):n(e)),r)}));for(this.throwErrorIfNotAvailable(),this.messages.push(["string"==typeof e?e:new b(this.workers,e),t,r,Date.now()+n,0]);this.messages.length>(this.available?this.settings.capacity:0);){const[e,t,r,,n]=this.messages.shift();n&&(0,i.clearTimeout)(n);const o="string"==typeof e?e:e[i.Symbol.iterator]().next().value;null===(s=this.events_)||void 0===s||s.loss.emit([o],[o,t]);try{r(void 0,new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: A message overflowed.`))}catch(e){(0,f.causeAsyncException)(e)}}0!==this.messages.length&&(this.throwErrorIfNotAvailable(),this.schedule(),n>0&&n!==i.Infinity&&(this.messages[this.messages.length-1][4]=(0,i.setTimeout)((()=>{this.schedule()}),n+3)))}cast(e,t,r=this.settings.timeout){var n,i;let s;for(e of(this.throwErrorIfNotAvailable(),"string"==typeof e?[e]:new b(this.workers,e)))if(s=null===(n=this.workers.get(e))||void 0===n?void 0:n.call([t,Date.now()+r]))break;return e=e,!!s||(null===(i=this.events_)||void 0===i||i.loss.emit([e],[e,t]),!1)}refs(e){return void 0===e?[...this.workers.values()].map(t):this.workers.has(e)?[t(this.workers.get(e))]:[];function t(e){return[e.name,e.process,e.state,e.terminate]}}kill(e,t){return!!this.available&&(!!this.workers.has(e)&&this.workers.get(e).terminate(t))}clear(e){for(;this.workers.size>0;)for(const t of this.workers.values())t.terminate(e)}terminate(e){return!!this.available&&(this.destructor(e),this[c.Coroutine.exit](void 0),!0)}[c.Coroutine.terminate](e){this.terminate(e)}schedule(){if(!this.available||this.scheduled||0===this.messages.length)return;this.scheduled=!0;const e=new u.AtomicFuture(!1);e.finally((()=>{this.scheduled=!1,this.deliver()})),this.settings.scheduler.call(void 0,e.bind),this.settings.scheduler===t.requestAnimationFrame&&(0,i.setTimeout)(e.bind,1e3)}deliver(){var e,t;if(!this.available)return;const r=Date.now();for(let n=0,s=this.messages.length;this.available&&n<s;++n){if(this.settings.resource-(Date.now()-r)<=0)return void this.schedule();const[o,c,a,u,l]=this.messages[n];let d,p;for(p of"string"==typeof o?[o]:o)if(d=null===(e=this.workers.get(p))||void 0===e?void 0:e.call([c,u]))break;if(!(void 0===d&&Date.now()<u))if((0,h.splice)(this.messages,n,1),--n,--s,l&&(0,i.clearTimeout)(l),void 0===d){null===(t=this.events_)||void 0===t||t.loss.emit([p],[p,c]);try{a(void 0,new i.Error("Spica: Supervisor: A process has failed."))}catch(e){(0,f.causeAsyncException)(e)}}else d.then((e=>{a(e)}),(()=>{a(void 0,new i.Error("Spica: Supervisor: A process has failed."))}))}}}r.Supervisor=v,n=c.Coroutine.port,v.standalone=new i.WeakSet;class b{constructor(e,t=(e=>e)){this.workers=e,this.selector=t}*[i.Symbol.iterator](){let e=0;for(const t of this.selector(this.workers.keys()))++e,yield t;0===e&&(yield"")}}class y{constructor(e,t,r,n,i,s,o,c){this.name=e,this.process=t,this.state=r,this.sv=n,this.schedule=i,this.events=o,this.destructor_=c,this.alive=!0,this.available=!0,this.initiated=!1,this.terminate=e=>!!this.alive&&(this.destructor(e),!0),s&&this.init()}destructor(e){this.alive=!1,this.available=!1,(0,s.ObjectFreeze)(this);try{this.destructor_()}catch(e){(0,f.causeAsyncException)(e)}this.initiated&&this.exit(e)}init(){var e;this.initiated=!0,null===(e=this.events)||void 0===e||e.init.emit([this.name],[this.name,this.process,this.state]),this.state=this.process.init(this.state,this.terminate)}exit(e){var t,r;try{this.process.exit(e,this.state),null===(t=this.events)||void 0===t||t.exit.emit([this.name],[this.name,this.process,this.state,e])}catch(t){null===(r=this.events)||void 0===r||r.exit.emit([this.name],[this.name,this.process,this.state,e]),this.sv.terminate(t)}}call([e,t]){const r=Date.now();if(this.available&&!(r>t))return new a.AtomicPromise(((n,o)=>{(0,s.isFinite)(t)&&(0,i.setTimeout)((()=>{o(new i.Error)}),t-r),this.available=!1,this.initiated||(this.init(),this.alive)?a.AtomicPromise.resolve(this.process.main(e,this.state,this.terminate)).then(n,o):o()})).then((([e,t])=>(this.alive&&(this.schedule(),this.state=t,this.available=!0),e))).catch((e=>{throw this.schedule(),this.terminate(e),e}))}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./alias":4,"./array":5,"./assign":6,"./clock":10,"./coroutine":13,"./exception":16,"./future":19,"./global":20,"./noop":86,"./observer":87,"./promise":88,"./sqid":91}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.debounce=r.throttle=void 0;const n=e("./global"),i=e("./exception");r.throttle=function(e,t,r=1){let s=0,o=[];return function c(a){1===r?o=[a]:(o.length===r&&o.pop(),o.unshift(a)),0===s&&(s=(0,n.setTimeout)((async()=>{const e=o;o=[];try{await t.call(this,e[0],e)}catch(e){(0,i.causeAsyncException)(e)}s=0,o.length>0&&c.call(this,o.shift())}),e))}},r.debounce=function(e,t,r=1){let s=0,o=[],c=!0;return function a(u){1===r?o=[u]:(o.length===r&&o.pop(),o.unshift(u)),0===s&&(s=(0,n.setTimeout)((()=>{s=0,(0,n.setTimeout)((async()=>{if(0!==s)return;if(!c)return;const e=o;o=[],c=!1;try{await t.call(this,e[0],e)}catch(e){(0,i.causeAsyncException)(e)}c=!0,0===s&&o.length>0&&a.call(this,o.shift())}),e)}),e))}}},{"./exception":16,"./global":20}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.wait=void 0;const n=e("./global"),i=e("./clock"),s=e("./promise");r.wait=function(e){return 0===e?s.AtomicPromise.resolve(i.clock):new s.AtomicPromise((t=>{(0,n.setTimeout)(t,e)}))}},{"./clock":10,"./global":20,"./promise":88}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tuple=void 0,r.tuple=function(...e){return e}},{}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isPrimitive=r.isType=r.type=void 0;const n=e("./alias"),i=Object.prototype.toString.call.bind(Object.prototype.toString),s=Object.prototype,o=Array.prototype;function c(e){if(void 0===e)return"undefined";if(null===e)return"null";const t=typeof e;if("object"===t){const t=(0,n.ObjectGetPrototypeOf)(e);return t===s||null===t?"Object":t===o?"Array":i(e).slice(8,-1)}return"function"===t?"Function":t}r.type=c,r.isType=function(e,t){return"object"===t?null!==e&&typeof e===t:"function"===t?typeof e===t:c(e)===t},r.isPrimitive=function(e){const t=typeof e;return"object"!==t&&"function"!==t||null===e}},{"./alias":4}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URL=r.ReadonlyURL=r.standardize=void 0;const n=e("./global"),i=e("./url/format");var s=e("./url/format");Object.defineProperty(r,"standardize",{enumerable:!0,get:function(){return s.standardize}});var o=e("./url/format");Object.defineProperty(r,"ReadonlyURL",{enumerable:!0,get:function(){return o.ReadonlyURL}});const c=Symbol.for("spica/url::internal");r.URL=class{constructor(e,t){this.source=e,this.base=t,this[c]={url:new i.ReadonlyURL(e,t),searchParams:void 0}}get href(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,`${this[c].url.href.slice(0,-this[c].url.query.length-this[c].url.fragment.length||this[c].url.href.length)}?`).concat(this.fragment))&&void 0!==t?t:this[c].url.href}get resource(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,`${this[c].url.href.slice(0,-this[c].url.query.length-this[c].url.fragment.length||this[c].url.href.length)}?`))&&void 0!==t?t:this[c].url.resource}get origin(){return this[c].url.origin}get scheme(){return this[c].url.protocol.slice(0,-1)}get protocol(){return this[c].url.protocol}get username(){return this[c].url.username}get password(){return this[c].url.password}get host(){return this[c].url.host}get hostname(){return this[c].url.hostname}get port(){return this[c].url.port}get path(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,`${this.pathname}?`))&&void 0!==t?t:this[c].url.path}get pathname(){return this[c].url.pathname}get search(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,"?"))&&void 0!==t?t:this[c].url.search}get query(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,"?"))&&void 0!==t?t:this[c].url.query}get hash(){return this[c].url.hash}get fragment(){return this[c].url.fragment}get searchParams(){var e,t;return null!==(e=(t=this[c]).searchParams)&&void 0!==e?e:t.searchParams=new n.URLSearchParams(this.search)}toString(){return this.href}toJSON(){return this.href}}},{"./global":20,"./url/format":99}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ReadonlyURL=r._encode=r.standardize=void 0;const n=e("../global"),i=e("../memoize"),s=e("../cache");function o(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,(e=>2===e.length?e:"")).replace(/%(?![0-9A-F]{2})|[^%\[\]]+/gi,n.encodeURI).replace(/\?[^#]+/,(e=>"?"+e.slice(1).replace(/%[0-9A-F]{2}|%|[^=&]+/gi,(e=>"%"===e[0]&&3===e.length?e:(0,n.encodeURIComponent)(e))))).replace(/%[0-9A-F]{2}/gi,(e=>e.toUpperCase())).replace(/#.+/,e.slice(e.indexOf("#")))}r.standardize=function(e,t){const r=new a(e,t);return o(e="null"===r.origin?r.protocol.toLowerCase()+r.href.slice(r.protocol.length):r.origin.toLowerCase()+r.href.slice(r.origin.length))},r._encode=o;const c=Symbol.for("spica/url::internal");class a{constructor(e,t){switch(this.source=e,this.base=t,e.slice(0,e.lastIndexOf("://",9)+1).toLowerCase()){case"http:":case"https:":t=void 0;break;default:switch(null==t?void 0:t.slice(0,t.lastIndexOf("://",9)+1).toLowerCase()){case"http:":case"https:":const r=t.indexOf("#");r>-1&&(t=t.slice(0,r));const n=t.indexOf("?");r>-1&&-1===e.indexOf("#")&&(t=t.slice(0,n))}}this[c]={share:a.get(e,t),searchParams:void 0}}get href(){var e,t;return null!==(e=(t=this[c].share).href)&&void 0!==e?e:t.href=this[c].share.url.href}get resource(){var e,t;return null!==(e=(t=this[c].share).resource)&&void 0!==e?e:t.resource=this.href.slice(0,-this.fragment.length-this.query.length||this.href.length)+this.search}get origin(){var e,t;return null!==(e=(t=this[c].share).origin)&&void 0!==e?e:t.origin=this[c].share.url.origin}get protocol(){var e,t;return null!==(e=(t=this[c].share).protocol)&&void 0!==e?e:t.protocol=this[c].share.url.protocol}get username(){var e,t;return null!==(e=(t=this[c].share).username)&&void 0!==e?e:t.username=this[c].share.url.username}get password(){var e,t;return null!==(e=(t=this[c].share).password)&&void 0!==e?e:t.password=this[c].share.url.password}get host(){var e,t;return null!==(e=(t=this[c].share).host)&&void 0!==e?e:t.host=this[c].share.url.host}get hostname(){var e,t;return null!==(e=(t=this[c].share).hostname)&&void 0!==e?e:t.hostname=this[c].share.url.hostname}get port(){var e,t;return null!==(e=(t=this[c].share).port)&&void 0!==e?e:t.port=this[c].share.url.port}get path(){var e,t;return null!==(e=(t=this[c].share).path)&&void 0!==e?e:t.path=`${this.pathname}${this.search}`}get pathname(){var e,t;return null!==(e=(t=this[c].share).pathname)&&void 0!==e?e:t.pathname=this[c].share.url.pathname}get search(){var e,t;return null!==(e=(t=this[c].share).search)&&void 0!==e?e:t.search=this[c].share.url.search}get query(){var e,t;return null!==(e=(t=this[c].share).query)&&void 0!==e?e:t.query=this.search||"?"===this.href[this.href.length-this.fragment.length-1]&&"?"||""}get hash(){var e,t;return null!==(e=(t=this[c].share).hash)&&void 0!==e?e:t.hash=this[c].share.url.hash}get fragment(){var e,t;return null!==(e=(t=this[c].share).fragment)&&void 0!==e?e:t.fragment=this.hash||"#"===this.href[this.href.length-1]&&"#"||""}get searchParams(){var e,t;return null!==(e=(t=this[c]).searchParams)&&void 0!==e?e:t.searchParams=new n.URLSearchParams(this.search)}toString(){return this.href}toJSON(){return this.href}}r.ReadonlyURL=a,a.get=(0,i.memoize)(((e,t)=>({url:new n.global.URL(e,t),href:void 0,resource:void 0,origin:void 0,protocol:void 0,username:void 0,password:void 0,host:void 0,hostname:void 0,port:void 0,path:void 0,pathname:void 0,search:void 0,query:void 0,hash:void 0,fragment:void 0})),((e,t="")=>`${t.indexOf("\n")>-1?t.replace(/\n+/g,""):t}\n${e}`),new s.Cache(1e4))},{"../cache":7,"../global":20,"../memoize":29}],100:[function(_dereq_,module,exports){var root,factory;_dereq_=function e(t,r,n){function i(o,c){if(!r[o]){if(!t[o]){var a="function"==typeof _dereq_&&_dereq_;if(!c&&a)return a(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[o]={exports:{}};t[o][0].call(l.exports,(function(e){return i(t[o][1][e]||e)}),l,l.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof _dereq_&&_dereq_,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{dup:1}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isArray=r.ObjectValues=r.ObjectSetPrototypeOf=r.ObjectSeal=r.ObjectPreventExtensions=r.ObjectKeys=r.isSealed=r.isFrozen=r.isExtensible=r.ObjectIs=r.ObjectGetPrototypeOf=r.ObjectGetOwnPropertySymbols=r.ObjectGetOwnPropertyNames=r.ObjectGetOwnPropertyDescriptors=r.ObjectGetOwnPropertyDescriptor=r.ObjectFromEntries=r.ObjectFreeze=r.ObjectEntries=r.ObjectDefineProperty=r.ObjectDefineProperties=r.ObjectCreate=r.ObjectAssign=r.toString=r.isEnumerable=r.isPrototypeOf=r.hasOwnProperty=r.SymbolKeyFor=r.SymbolFor=r.sign=r.round=r.random=r.min=r.max=r.floor=r.ceil=r.abs=r.parseInt=r.parseFloat=r.isSafeInteger=r.isNaN=r.isInteger=r.isFinite=r.NaN=void 0,r.NaN=Number.NaN,r.isFinite=Number.isFinite,r.isInteger=Number.isInteger,r.isNaN=Number.isNaN,r.isSafeInteger=Number.isSafeInteger,r.parseFloat=Number.parseFloat,r.parseInt=Number.parseInt,r.abs=Math.abs,r.ceil=Math.ceil,r.floor=Math.floor,r.max=Math.max,r.min=Math.min,r.random=Math.random,r.round=Math.round,r.sign=Math.sign,r.SymbolFor=Symbol.for,r.SymbolKeyFor=Symbol.keyFor,r.hasOwnProperty=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),r.isPrototypeOf=Object.prototype.isPrototypeOf.call.bind(Object.prototype.isPrototypeOf),r.isEnumerable=Object.prototype.propertyIsEnumerable.call.bind(Object.prototype.propertyIsEnumerable),r.toString=Object.prototype.toString.call.bind(Object.prototype.toString),r.ObjectAssign=Object.assign,r.ObjectCreate=Object.create,r.ObjectDefineProperties=Object.defineProperties,r.ObjectDefineProperty=Object.defineProperty,r.ObjectEntries=Object.entries,r.ObjectFreeze=Object.freeze,r.ObjectFromEntries=Object.fromEntries,r.ObjectGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,r.ObjectGetOwnPropertyDescriptors=Object.getOwnPropertyDescriptors,r.ObjectGetOwnPropertyNames=Object.getOwnPropertyNames,r.ObjectGetOwnPropertySymbols=Object.getOwnPropertySymbols,r.ObjectGetPrototypeOf=Object.getPrototypeOf,r.ObjectIs=Object.is,r.isExtensible=Object.isExtensible,r.isFrozen=Object.isFrozen,r.isSealed=Object.isSealed,r.ObjectKeys=Object.keys,r.ObjectPreventExtensions=Object.preventExtensions,r.ObjectSeal=Object.seal,r.ObjectSetPrototypeOf=Object.setPrototypeOf,r.ObjectValues=Object.values,r.isArray=Array.isArray},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.join=r.splice=r.pop=r.push=r.shift=r.unshift=r.indexOf=void 0;const n=e("./global");function i(e,t){if("length"in e)for(let r=e.length-1;r>=0;--r)t.unshift(e[r]);else t.unshift(...e);return t}function s(e,t){if("length"in t)for(let r=0,n=t.length;r<n;++r)e.push(t[r]);else for(const r of t)e.push(r);return e}function o(e,t,r,...c){if(0===r&&0===c.length)return[];switch(r=r>e.length?e.length:r,t){case 0:switch(r){case 0:return[[],i(c,e)][0];case 1:return 0===e.length?[[],i(c,e)][0]:[[e.shift()],i(c,e)][0];case void 0:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:o(e,t,1)}break;case-1:case e.length-1:switch(r){case 1:return 0===e.length?[[],s(e,c)][0]:[[e.pop()],s(e,c)][0];case void 0:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:o(e,t,1)}break;case e.length:case n.Infinity:return[[],s(e,c)][0]}return arguments.length>2?e.splice(t,r,...c):e.splice(t)}r.indexOf=function(e,t){return 0===e.length?-1:t==t?e.indexOf(t):e.findIndex((e=>e!=e))},r.unshift=i,r.shift=function(e,t){if(t<0)throw new Error("Unexpected negative number");return void 0===t?[e.shift(),e]:[o(e,0,t),e]},r.push=s,r.pop=function(e,t){if(t<0)throw new Error("Unexpected negative number");return void 0===t?[e,e.pop()]:[e,o(e,e.length-t,t)]},r.splice=o,r.join=function(e,t=""){let r="";for(let n=0;n<e.length;++n)r+=0===n?e[n]:t+e[n];return r}},{"./global":8}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.equal=void 0,r.equal=function(e,t){return e==e?e===t:t!=t}},{}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clear=r.singleton=void 0;const n=e("./noop");r.singleton=function(e){let t;return function(...r){return e===n.noop||(t=e.call(this,...r),e=n.noop),t}},r.clear=function(e){return(...t)=>{e(...t)}}},{"./noop":10}],8:[function(_dereq_,module,exports){"use strict";const global="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||Function("return this")();eval("global.global = global"),module.exports=global},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reduce=r.memoize=void 0;const n=e("./global"),i=e("./compare");r.memoize=function e(t,r=((...e)=>e[0]),i){if("object"==typeof r)return e(t,void 0,r);if(void 0===i)return e(t,r,new n.Map);let s=!1;return(...e)=>{const n=r(...e);let o=i.get(n);return void 0!==o||s&&i.has(n)||(o=t(...e),s||(s=void 0===o),i.set(n,o)),o}},r.reduce=function(e,t=((...e)=>e[0])){let r=[],n=[];return(...s)=>{const o=t(...s);return(0,i.equal)(r,o)||(r=o,n=e(...s)),n}}},{"./compare":6,"./global":8}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.noop=void 0,r.noop=function(){}},{}],11:[function(e,t,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.never=r.isPromiseLike=r.Internal=r.AtomicPromise=void 0;const s=e("./global"),o=e("./alias"),c=e("./noop"),a=Symbol.for("spica/promise::internal");class u{constructor(e){this[n]="Promise",this[i]=new l;try{e((e=>{this[a].resolve(e)}),(e=>{this[a].reject(e)}))}catch(e){this[a].reject(e)}}static get[Symbol.species](){return u}static all(e){return new u(((t,r)=>{const n=(0,o.isArray)(e)?e:[...e],i=(0,s.Array)(n.length);let c=!1,u=0;for(let e=0;!c&&e<n.length;++e){const s=n[e];if(p(s)){if(f(s)){const{status:t}=s[a];switch(t.state){case 2:i[e]=t.value,++u;continue;case 3:return r(t.reason)}}s.then((r=>{i[e]=r,++u,u===n.length&&t(i)}),(e=>{r(e),c=!0}))}else i[e]=s,++u}u===n.length&&t(i)}))}static race(e){return new u(((t,r)=>{const n=(0,o.isArray)(e)?e:[...e];for(let e=0;e<n.length;++e){const i=n[e];if(!p(i))return t(i);if(f(i)){const{status:e}=i[a];switch(e.state){case 2:return t(e.value);case 3:return r(e.reason)}}}let i=!1;for(let e=0;!i&&e<n.length;++e){n[e].then((e=>{t(e),i=!0}),(e=>{r(e),i=!0}))}}))}static allSettled(e){return new u((t=>{const r=(0,o.isArray)(e)?e:[...e],n=(0,s.Array)(r.length);let i=0;for(let e=0;e<r.length;++e){const s=r[e];if(p(s)){if(f(s)){const{status:t}=s[a];switch(t.state){case 2:n[e]={status:"fulfilled",value:t.value},++i;continue;case 3:n[e]={status:"rejected",reason:t.reason},++i;continue}}s.then((s=>{n[e]={status:"fulfilled",value:s},++i,i===r.length&&t(n)}),(s=>{n[e]={status:"rejected",reason:s},++i,i===r.length&&t(n)}))}else n[e]={status:"fulfilled",value:s},++i}i===r.length&&t(n)}))}static any(e){return new u(((t,r)=>{const n=(0,o.isArray)(e)?e:[...e],i=(0,s.Array)(n.length);let c=!1,u=0;for(let e=0;!c&&e<n.length;++e){const s=n[e];if(!p(s))return t(s);if(f(s)){const{status:r}=s[a];switch(r.state){case 2:return t(r.value);case 3:i[e]=r.reason,++u;continue}}s.then((e=>{t(e),c=!0}),(t=>{i[e]=t,++u,u===n.length&&r(new AggregateError(i,"All promises were rejected"))}))}u===n.length&&r(new AggregateError(i,"All promises were rejected"))}))}static resolve(e){return new u((t=>t(e)))}static reject(e){return new u(((t,r)=>r(e)))}then(e,t){return new u(((r,n)=>this[a].then(r,n,e,t)))}catch(e){return this.then(void 0,e)}finally(e){return this.then(e,e).then((()=>this))}}r.AtomicPromise=u,n=Symbol.toStringTag,i=a;class l{constructor(){this.status={state:0},this.fulfillReactions=[],this.rejectReactions=[]}get isPending(){return 0===this.status.state}resolve(e){if(0===this.status.state){if(!p(e))return this.status={state:2,value:e},this.resume();if(f(e)){const t=e[a];switch(t.status.state){case 2:case 3:return this.status=t.status,this.resume();default:return t.then((()=>(this.status=t.status,this.resume())),(()=>(this.status=t.status,this.resume())))}}this.status={state:1,promise:e},e.then((e=>{this.status={state:2,value:e},this.resume()}),(e=>{this.status={state:3,reason:e},this.resume()}))}}reject(e){if(0===this.status.state)return this.status={state:3,reason:e},this.resume()}then(e,t,r,n){const{status:i,fulfillReactions:s,rejectReactions:o}=this;switch(i.state){case 2:if(0!==s.length)break;return d(e,t,e,r,i.value);case 3:if(0!==o.length)break;return d(e,t,t,n,i.reason)}s.push([e,t,e,r]),o.push([e,t,t,n])}resume(){const{status:e,fulfillReactions:t,rejectReactions:r}=this;switch(e.state){case 0:case 1:return;case 2:if(0!==r.length&&(this.rejectReactions=[]),0===t.length)return;return h(t,e.value),void(this.fulfillReactions=[]);case 3:if(0!==t.length&&(this.fulfillReactions=[]),0===r.length)return;return h(r,e.reason),void(this.rejectReactions=[])}}}function h(e,t){for(let r=0;r<e.length;++r){const n=e[r];d(n[0],n[1],n[2],n[3],t)}}function d(e,t,r,n,i){if(!n)return r(i);try{e(n(i))}catch(e){t(e)}}function p(e){return null!==e&&"object"==typeof e&&"function"==typeof e.then}function f(e){return a in e}r.Internal=l,r.isPromiseLike=p,r.never=new class e extends Promise{static get[Symbol.species](){return e}constructor(){super(c.noop)}then(){return this}catch(){return this}finally(){return this}}},{"./alias":4,"./global":8,"./noop":10}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.unique=r.rnd0Z=r.rnd0z=r.rnd0f=r.rnd64=r.rnd62=r.rnd36=r.rnd32=r.rnd16=void 0;const n=e("./global"),i=[...Array(7)].map(((e,t)=>1<<t)),s=[...[...Array(36)].map(((e,t)=>t.toString(36))),...[...Array(36)].map(((e,t)=>t.toString(36).toUpperCase())).slice(-26)];function o(e){const t=i.find((t=>t>=e)),r=i.indexOf(t);return()=>{for(;;){const t=d(r);if(t<e)return t}}}function c(e){return(t=1)=>{let r="";for(;t--;)r+=s[e()];return r}}r.rnd16=o(16),r.rnd32=o(32),r.rnd36=o(36),r.rnd62=o(62),r.rnd64=o(64),r.rnd0f=c(r.rnd16),r.rnd0z=c(r.rnd36),r.rnd0Z=c(r.rnd62),r.unique=function(e,t,r){const i=!r;null!=r||(r=new n.Set);let s=5;return()=>{for(;;){for(let n=0;n<s;++n){const n=e(t);if(!r.has(n))return r.add(n),n}i&&r.clear(),++t,s=t<3?s:3}}};const a=new Uint16Array(512),u=i.map(((e,t)=>+`0b${"1".repeat(t)||0}`));let l=a.length,h=16;function d(e){return l===a.length&&(n.crypto.getRandomValues(a),l=0),h===e?(h=16,a[l++]&u[e]):h>e?(h-=e,a[l]>>h&u[e]):(h=16,++l,d(e))}},{"./global":8}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SVG=r.HTML=r.Shadow=r.API=void 0;const n=e("spica/alias"),i=e("./proxy"),s=e("./util/dom");function o(e,t=(e=>e)){return new Proxy((()=>{}),function(e,t){return{apply(e,t,[r,...n]){return this.get(e,r,e)(...n)},get:(t,n)=>t[n]||n in t||"string"!=typeof n?t[n]:t[n]=r(n,e)};function r(e,r){return function e(r,n,s){if("function"==typeof r)return e(void 0,void 0,r);if("function"==typeof n)return e(r,void 0,n);if(void 0!==r&&o(r))return e(void 0,r,s);const a=t(c(s,r,n));return 1===a.nodeType?new i.Elem(a,n):new i.Elem(a.host,n,a)};function o(e){if("object"!=typeof e)return!0;for(const t in e)if((0,n.hasOwnProperty)(e,t))return"object"==typeof e[t];return!0}function c(t,n,i){const o=t?(0,s.define)(t(r,e,null!=n?n:{},i),n):r(e,n);if(e!==o.tagName.toLowerCase())throw new Error(`TypedDOM: Expected tag name is "${e}" but actually "${o.tagName.toLowerCase()}".`);return o}}}(e,t))}r.API=o,r.Shadow=o(s.html,s.shadow),r.HTML=o(s.html),r.SVG=o(s.svg)},{"./proxy":14,"./util/dom":15,"spica/alias":4}],14:[function(e,t,r){"use strict";var n,i,s,o;Object.defineProperty(r,"__esModule",{value:!0}),r.Elem=r.proxy=void 0;const c=e("spica/global"),a=e("spica/alias"),u=e("./util/identity"),l=e("./util/dom"),h=e("spica/array"),d=new c.WeakMap;function p(e){const t=d.get(e);if(t)return t;throw new Error("TypedDOM: This element has no proxy.")}var f;r.proxy=p,function(e){e.id=Symbol(),e.id_=Symbol(),e.query=Symbol(),e.query_=Symbol(),e.scope=Symbol(),e.observe=Symbol(),e.type=Symbol(),e.container=Symbol(),e.children=Symbol(),e.isInit=Symbol(),e.isPartialUpdate=Symbol()}(f||(f={}));Symbol.for("typed-dom::tag");let m=(0,u.identity)(),v=0;class b{constructor(e,t,r=e){switch(this.element=e,this[n]="",this[i]="",this[s]=!1,this[o]=!0,this[f.children]=t,this[f.container]=r,!0){case void 0===t:this[f.type]=0;break;case"string"==typeof t:this[f.type]=1;break;case(0,a.isArray)(t):this[f.type]=2;break;case t&&"object"==typeof t:this[f.type]=3;break;default:throw new Error("TypedDOM: Invalid children type.")}switch(y(this),d.set(this.element,this),this[f.type]){case 0:return void(this[f.isInit]=!1);case 1:return(0,l.define)(this[f.container],[]),this[f.children]=this[f.container].appendChild((0,l.text)("")),this.children=t,void(this[f.isInit]=!1);case 2:return(0,l.define)(this[f.container],[]),this[f.children]=[],this.children=t,void(this[f.isInit]=!1);case 3:return(0,l.define)(this[f.container],[]),this[f.children]=this[f.observe]({...t}),this.children=t,void(this[f.isInit]=!1);default:throw new Error("TypedDOM: Unreachable code.")}}get[(n=f.id_,f.id)](){return this[f.id_]?this[f.id_]:(this[f.id_]=this.element.id,/^[\w-]+$/.test(this[f.id_])||(999===v&&(m=(0,u.identity)(),v=0),this[f.id_]=`rnd-${m}-${++v}`,this.element.classList.add(this[f.id_])),this[f.id_])}get[(i=f.query_,f.query)](){if(this[f.query_])return this[f.query_];switch(!0){case this.element!==this[f.container]:return this[f.query_]=":host";case this[f.id]===this.element.id:return this[f.query_]=`#${this[f.id]}`;default:return this[f.query_]=`.${this[f.id]}`}}[f.scope](e){if("STYLE"!==e.element.tagName)return;const t=/(^|[,}]|\*\/)(\s*)\$scope(?=[\s~+[{:>,])/g,r=e.element.innerHTML;t.test(r)&&(e.element.innerHTML=r.replace(t,`$1$2${this[f.query]}`),e.element.firstElementChild&&e.element.replaceChildren())}[(s=f.isPartialUpdate,f.observe)](e){const t={};let r=-1;for(const n of(0,a.ObjectKeys)(e)){if(n in{})throw new Error("TypedDOM: Child names must be different from the object property names.");++r;let i=e[n];y(i),i.element!==this[f.container].children[r]&&this[f.container].appendChild(i.element),t[n]={configurable:!0,enumerable:!0,get:()=>i,set:e=>{const t=i;if(e!==t)if(this[f.isPartialUpdate])if(i=e,e.element.parentNode===t.element.parentNode){const r=e.element.nextSibling!==t.element?e.element.nextSibling:t.element.nextSibling;this[f.container].replaceChild(e.element,t.element),this[f.container].insertBefore(t.element,r)}else this[f.container].insertBefore(e.element,t.element),this[f.container].removeChild(t.element);else this.children={...this[f.children],[n]:e}}}}return(0,a.ObjectDefineProperties)(e,t)}get children(){if(1===this[f.type]){if(this[f.children].parentNode!==this[f.container]){this[f.children]=void 0;for(let e=this[f.container].childNodes,t=0,r=e.length;t<r;++t){const r=e[t];if("wholeText"in r!=!1){this[f.children]=r;break}}}return this[f.children].data}return this[f.children]}set children(e){const t=[],r=[];let n=!1;switch(this[f.type]){case 0:return;case 1:{if(!this[f.isInit]&&e===this.children)return;const t=this[f.children],r=t.data,n=e;if(t.data=n,n===r)return;return void this.element.dispatchEvent(new c.Event("mutate",{bubbles:!1,cancelable:!0}))}case 2:{const i=e,s=[];this[f.children]=s;const o=this[f.container].children;for(let e=0;e<i.length;++e){const t=i[e],c=o[e];t.element.parentNode!==this[f.container]&&y(t),t.element!==c&&(t.element.parentNode!==this[f.container]&&(this[f.scope](t),r.push(t)),this[f.container].insertBefore(t.element,c),n=!0),s.push(t)}for(let e=o.length;i.length<e--;){const e=o[i.length];d.has(e)&&(t.push(p(this[f.container].removeChild(e))),n=!0)}break}case 3:{const i=e,s=this[f.children];for(const e of(0,a.ObjectKeys)(s)){const o=s[e],c=i[e];if(this[f.isInit]||c!==o){if(c.element.parentNode!==this[f.container]&&y(c),(this[f.isInit]||c!==o&&c.element.parentNode!==o.element.parentNode)&&(this[f.scope](c),r.push(c),!this[f.isInit])){let e=0;e=t.lastIndexOf(c),e>-1&&(0,h.splice)(t,e,1),t.push(o),e=r.lastIndexOf(o),e>-1&&(0,h.splice)(r,e,1)}this[f.isPartialUpdate]=!0,s[e]=i[e],this[f.isPartialUpdate]=!1,n=!0}}break}}if(t.length){const e=new c.Event("disconnect",{bubbles:!1,cancelable:!0});for(const{element:r}of t)r.dispatchEvent(e)}if(r.length){const e=new c.Event("connect",{bubbles:!1,cancelable:!0});for(const{element:t}of r)t.dispatchEvent(e)}n&&this.element.dispatchEvent(new c.Event("mutate",{bubbles:!1,cancelable:!0}))}}function y({element:e}){if(e.parentElement&&d.has(e.parentElement))throw new Error("TypedDOM: Typed DOM children must not be used to another typed DOM.")}r.Elem=b,f.type,f.container,o=f.isInit,f.children},{"./util/dom":15,"./util/identity":16,"spica/alias":4,"spica/array":5,"spica/global":8}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defrag=r.isChildren=r.define=r.element=r.text=r.svg=r.html=r.frag=r.shadow=void 0;const n=e("spica/global"),i=e("spica/alias"),s=e("spica/memoize");var o;function c(e,t){const r=(0,s.memoize)(a,((e,t,r)=>`${t}:${r}`));return(n,i,s)=>{const o=n.includes("-")?a(e,t,n):r(e,t,n).cloneNode(!0);return h(i)?l(o,i):l(u(o,i),s)}}function a(e,t,r){if(!("createElement"in e))throw new Error("TypedDOM: Scoped custom elements are not supported on this browser.");switch(t){case"HTML":return e.createElement(r);case"SVG":return e.createElementNS("http://www.w3.org/2000/svg",r)}}function u(e,t){if(!t)return e;for(let r=0,n=(0,i.ObjectKeys)(t);r<n.length;++r){const i=n[r],s=t[i];switch(typeof s){case"string":e.setAttribute(i,s);continue;case"function":if(i.length<3)throw new Error(`TypedDOM: Attribute names for event listeners must have an event name but got "${i}".`);const t=i.split(/\s+/);for(let r=0;r<t.length;++r){const n=t[r];if("on"!==n.slice(0,2))throw new Error(`TypedDOM: Attribute names for event listeners must start with "on" but got "${n}".`);e.addEventListener(n.slice(2),s,{passive:["wheel","mousewheel","touchstart","touchmove","touchend","touchcancel"].includes(n.slice(2))})}continue;case"object":e.removeAttribute(i);continue;default:continue}}return e}function l(e,t){return void 0===t||e.replaceChildren(..."string"==typeof t?[t]:t),e}function h(e){return!!(null==e?void 0:e[n.Symbol.iterator])}!function(e){e.shadows=new WeakMap,e.fragment=n.document.createDocumentFragment()}(o||(o={})),r.shadow=function e(t,n,i){var s,c;if("string"==typeof t)return e((0,r.html)(t),n,i);if(n&&!h(n))return e(t,void 0,n);const a=void 0===i?null!==(s=t.shadowRoot)&&void 0!==s?s:o.shadows.get(t):"open"===i.mode?null!==(c=t.shadowRoot)&&void 0!==c?c:void 0:o.shadows.get(t);return l(i&&"open"!==i.mode?null!=a?a:o.shadows.set(t,t.attachShadow(i)).get(t):null!=a?a:t.attachShadow(null!=i?i:{mode:"open"}),a||void 0!==n?n:t.childNodes)},r.frag=function(e){return l(o.fragment.cloneNode(!0),e)},r.html=c(n.document,"HTML"),r.svg=c(n.document,"SVG"),r.text=function(e){return n.document.createTextNode(e)},r.element=c,r.define=function(e,t,r){return h(t)?l(e,t):l(u(e,t),r)},r.isChildren=h,r.defrag=function(e){const t=[];for(let r=0;r<e.length;++r){const n=e[r];""!==n&&(t.length>0&&"string"==typeof n&&"string"==typeof e[r-1]?t[t.length-1]+=n:t.push(n))}return t}},{"spica/alias":4,"spica/global":8,"spica/memoize":9}],16:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.identity=void 0;const i=e("spica/global"),s=e("spica/random"),o=Symbol.for("typed-dom::ids");r.identity=(0,s.unique)(s.rnd0Z,2,null!==(n=i.global[o])&&void 0!==n?n:i.global[o]=new i.Set)},{"spica/global":8,"spica/random":12}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bind=r.delegate=r.wait=r.once=r.listen=r.currentTarget=void 0;const n=e("spica/promise"),i=e("spica/function"),s=e("spica/noop");function o(e,t,r,n=!1,i={}){return"string"==typeof r?c(e,t,r,n,{..."boolean"==typeof i?{capture:i}:i,once:!0}):a(e,t,r,{..."boolean"==typeof n?{capture:n}:n,once:!0})}function c(e,t,r,n,i={}){let c=s.noop;return a(e,r,(e=>{var s,a;c();const u=e.target.shadowRoot?null===(s=e.composedPath()[0])||void 0===s?void 0:s.closest(t):null===(a=e.target)||void 0===a?void 0:a.closest(t);return u?c=o(u,r,n,i):void 0}),{...i,capture:!0})}function a(e,t,n,s=!1){return e.addEventListener(t,o,s),(0,i.singleton)((()=>{e.removeEventListener(t,o,s)}));function o(e){return e[r.currentTarget]=e.currentTarget,n(e)}}r.currentTarget=Symbol.for("typed-dom::currentTarget"),r.listen=function(e,t,r,n=!1,i={}){return"string"==typeof r?c(e,t,r,n,i):a(e,t,r,n)},r.once=o,r.wait=function(e,t,r=!1,i={}){return new n.AtomicPromise((n=>"string"==typeof r?o(e,t,r,n,i):o(e,t,n,r)))},r.delegate=c,r.bind=a},{"spica/function":7,"spica/noop":10,"spica/promise":11}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.apply=void 0;const n=e("./dom");r.apply=function(e,t,r){const i=e.querySelectorAll(t);for(let e=0,t=i.length;e<t;++e)(0,n.define)(i[e],r);return i}},{"./dom":15}],"typed-dom":[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.identity=r.apply=r.currentTarget=r.wait=r.once=r.bind=r.delegate=r.listen=r.defrag=r.define=r.element=r.text=r.svg=r.html=r.frag=r.shadow=r.proxy=r.API=r.SVG=r.HTML=r.Shadow=void 0,e("spica/global");var n=e("./src/builder");Object.defineProperty(r,"Shadow",{enumerable:!0,get:function(){return n.Shadow}}),Object.defineProperty(r,"HTML",{enumerable:!0,get:function(){return n.HTML}}),Object.defineProperty(r,"SVG",{enumerable:!0,get:function(){return n.SVG}}),Object.defineProperty(r,"API",{enumerable:!0,get:function(){return n.API}});var i=e("./src/proxy");Object.defineProperty(r,"proxy",{enumerable:!0,get:function(){return i.proxy}});var s=e("./src/util/dom");Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return s.shadow}}),Object.defineProperty(r,"frag",{enumerable:!0,get:function(){return s.frag}}),Object.defineProperty(r,"html",{enumerable:!0,get:function(){return s.html}}),Object.defineProperty(r,"svg",{enumerable:!0,get:function(){return s.svg}}),Object.defineProperty(r,"text",{enumerable:!0,get:function(){return s.text}}),Object.defineProperty(r,"element",{enumerable:!0,get:function(){return s.element}}),Object.defineProperty(r,"define",{enumerable:!0,get:function(){return s.define}}),Object.defineProperty(r,"defrag",{enumerable:!0,get:function(){return s.defrag}});var o=e("./src/util/listener");Object.defineProperty(r,"listen",{enumerable:!0,get:function(){return o.listen}}),Object.defineProperty(r,"delegate",{enumerable:!0,get:function(){return o.delegate}}),Object.defineProperty(r,"bind",{enumerable:!0,get:function(){return o.bind}}),Object.defineProperty(r,"once",{enumerable:!0,get:function(){return o.once}}),Object.defineProperty(r,"wait",{enumerable:!0,get:function(){return o.wait}}),Object.defineProperty(r,"currentTarget",{enumerable:!0,get:function(){return o.currentTarget}});var c=e("./src/util/query");Object.defineProperty(r,"apply",{enumerable:!0,get:function(){return c.apply}});var a=e("./src/util/identity");Object.defineProperty(r,"identity",{enumerable:!0,get:function(){return a.identity}})},{"./src/builder":13,"./src/proxy":14,"./src/util/dom":15,"./src/util/identity":16,"./src/util/listener":17,"./src/util/query":18,"spica/global":8}]},{},[1,2,"typed-dom",3]),root="undefined"!=typeof self?self:this,factory=function(){return _dereq_("typed-dom")},"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.commonJsStrict=factory()},{"typed-dom":100}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.Pjax=void 0;var n=e("./layer/interface/service/gui");Object.defineProperty(r,"Pjax",{enumerable:!0,get:function(){return n.GUI}}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n.GUI}})},{"./layer/interface/service/gui":130}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.route=r.scope=r.Config=r.RouterEventSource=r.RouterEventType=r.RouterEvent=void 0;const n=e("../domain/router/api");var i=e("../domain/event/router");Object.defineProperty(r,"RouterEvent",{enumerable:!0,get:function(){return i.RouterEvent}}),Object.defineProperty(r,"RouterEventType",{enumerable:!0,get:function(){return i.RouterEventType}}),Object.defineProperty(r,"RouterEventSource",{enumerable:!0,get:function(){return i.RouterEventSource}});var s=e("../domain/data/config");Object.defineProperty(r,"Config",{enumerable:!0,get:function(){return s.Config}}),Object.defineProperty(r,"scope",{enumerable:!0,get:function(){return s.scope}}),r.route=function(e,t,r,i){return(0,n.route)(new n.RouterEntity(e,t,new n.RouterEntityState(r.process,r.scripts)),i)}},{"../domain/data/config":105,"../domain/event/router":107,"../domain/router/api":108}],103:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.savePosition=r.loadTitle=void 0;var n=e("../domain/store/path");Object.defineProperty(r,"loadTitle",{enumerable:!0,get:function(){return n.loadTitle}}),Object.defineProperty(r,"savePosition",{enumerable:!0,get:function(){return n.savePosition}})},{"../domain/store/path":124}],104:[function(e,t,r){"use strict";function n(){window.history.replaceState({...window.history.state,title:document.title},document.title)}function i(){var e;window.history.replaceState({...window.history.state,position:{...null===(e=window.history.state)||void 0===e?void 0:e.position,top:window.pageYOffset,left:window.pageXOffset}},document.title)}Object.defineProperty(r,"__esModule",{value:!0}),r.savePjax=r.isTransitable=r.savePosition=r.loadPosition=r.saveTitle=r.loadTitle=void 0,n(),i(),r.loadTitle=function(){var e;return(null===(e=window.history.state)||void 0===e?void 0:e.title)||document.title},r.saveTitle=n,r.loadPosition=function(){var e;return(null===(e=window.history.state)||void 0===e?void 0:e.position)||{top:window.pageYOffset,left:window.pageXOffset}},r.savePosition=i,r.isTransitable=function(e){var t,r;return null!==(r=!0===(null===(t=null==e?void 0:e.pjax)||void 0===t?void 0:t.transition))&&void 0!==r&&r},r.savePjax=function(){var e;window.history.replaceState({...window.history.state,pjax:{...null===(e=window.history.state)||void 0===e?void 0:e.pjax,transition:!0}},document.title)}},{}],105:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Config=r.scope=void 0;const n=e("spica/alias"),i=e("spica/assign");var s=e("./config/scope");Object.defineProperty(r,"scope",{enumerable:!0,get:function(){return s.scope}});r.Config=class{constructor(e){var t;this.areas=["body"],this.link="a, area",this.form="form:not([method])",this.replace="",this.fetch={rewrite:e=>e,cache:(e,t)=>"",headers:new Headers,timeout:3e3,wait:0},this.update={rewrite:(e,t)=>{},head:"base, meta, link",css:!0,script:!0,ignore:"",ignores:{extension:'[href^="chrome-extension://"]',security:'[src*=".scr.kaspersky-labs.com/"]'},reload:"",logger:""},this.sequence=new o,this.progressbar="display:none;position:absolute;bottom:0;left:0;width:0;height:2px;background:rgb(40, 105, 255);",this.scope={},(0,n.ObjectDefineProperties)(this.update,{ignore:{enumerable:!1,set(e){this.ignores._=e},get(){return(0,n.ObjectKeys)(this.ignores).map((e=>this.ignores[e])).filter((e=>e.trim().length>0)).join(",")}}}),(0,i.extend)(this,e),(0,i.overwrite)(this.scope,null!==(t=null==e?void 0:e.scope)&&void 0!==t?t:{}),this.fetch.headers=new Headers(this.fetch.headers),(0,n.ObjectFreeze)(this),this.fetch.headers.set("X-Requested-With","XMLHttpRequest"),this.fetch.headers.set("X-Pjax","1")}filter(e){return e.matches("[href]:not([target])")}fallback(e,t){if(e instanceof HTMLAnchorElement)window.location.assign(e.href);else if(e instanceof HTMLFormElement)window.location.assign(e.action);else{if(!(e instanceof Window))throw t;window.location.reload()}}};class o{async fetch(){return"fetch"}async unload(){return"unload"}async content(){return"content"}async ready(){return"ready"}async load(){}}},{"./config/scope":106,"spica/alias":4,"spica/assign":6}],106:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scope=void 0;const n=e("spica/alias"),i=e("../../../domain/data/config"),s=e("spica/router"),o=e("spica/sequence"),c=e("spica/maybe"),a=e("spica/assign");r.scope=function(e,t){var r;const u={"/":{},...e.scope};return null!==(r=o.Sequence.from((0,n.ObjectKeys)(u).sort().reverse()).dropWhile((e=>!(0,s.compare)(e,t.orig)&&!(0,s.compare)(e,t.dest))).take(1).filter((e=>!!(0,s.compare)(e,t.orig)&&(0,s.compare)(e,t.dest))).map((e=>u[e])).map((t=>t?(0,c.Just)(new i.Config((0,a.extend)({scope:t.scope&&(0,a.overwrite)(e.scope,t.scope)},e,t))):c.Nothing)).extract()[0])&&void 0!==r?r:c.Nothing}},{"../../../domain/data/config":105,"spica/alias":4,"spica/assign":6,"spica/maybe":28,"spica/router":89,"spica/sequence":90}],107:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RouterEventLocation=r.RouterEventRequest=r.RouterEventMethod=r.RouterEventType=r.RouterEventSource=r.RouterEvent=void 0;const n=e("spica/alias"),i=e("../../../lib/dom"),s=e("spica/url"),o=e("typed-dom");var c,a;r.RouterEvent=class{constructor(e){this.original=e,this.type=this.original.type.toLowerCase(),this.source=this.original[o.currentTarget],this.request=new u(this.source),this.location=new l(this.request.url),(0,n.ObjectFreeze)(this)}},function(e){e.Anchor=HTMLAnchorElement,e.Area=HTMLAreaElement,e.Form=HTMLFormElement,e.Window=window.Window}(c=r.RouterEventSource||(r.RouterEventSource={})),function(e){e.Click="click",e.Submit="submit",e.Popstate="popstate"}(r.RouterEventType||(r.RouterEventType={})),function(e){e.GET="GET",e.POST="POST"}(a=r.RouterEventMethod||(r.RouterEventMethod={}));class u{constructor(e){this.source=e,this.method=(()=>{if(this.source instanceof c.Anchor||this.source instanceof c.Area)return a.GET;if(this.source instanceof c.Form)return this.source.method.toUpperCase()===a.POST?a.POST:a.GET;if(this.source instanceof c.Window)return a.GET;throw new TypeError})(),this.url=(()=>{if(this.source instanceof c.Anchor||this.source instanceof c.Area)return new s.URL((0,s.standardize)(this.source.href,window.location.href));if(this.source instanceof c.Form)return this.source.method.toUpperCase()===a.GET?new s.URL((0,s.standardize)(this.source.action.split(/[?#]/)[0]+`?${(0,i.serialize)(this.source)}`,window.location.href)):new s.URL((0,s.standardize)(this.source.action.split(/[?#]/)[0],window.location.href));if(this.source instanceof c.Window)return new s.URL((0,s.standardize)(window.location.href));throw new TypeError})(),this.body=(()=>this.source instanceof c.Form&&this.method===a.POST?new FormData(this.source):null)(),(0,n.ObjectFreeze)(this)}}r.RouterEventRequest=u;class l{constructor(e){this.dest=e,this.orig=new s.URL((0,s.standardize)(window.location.href)),(0,n.ObjectFreeze)(this)}}r.RouterEventLocation=l},{"../../../lib/dom":137,"spica/alias":4,"spica/url":98,"typed-dom":100}],108:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.route=r.RouterEntityState=r.RouterEntity=void 0;const n=e("./module/fetch"),i=e("./module/update"),s=e("./module/update/content"),o=e("../store/path"),c=e("spica/either");var a=e("./model/eav/entity");Object.defineProperty(r,"RouterEntity",{enumerable:!0,get:function(){return a.RouterEntity}}),Object.defineProperty(r,"RouterEntityState",{enumerable:!0,get:function(){return a.RouterEntityState}}),r.route=async function(e,t){return(0,c.Right)(void 0).bind(e.state.process.either).bind((()=>function(e,t){return(0,s.separate)({src:e,dst:e},t).extract((()=>!1),(()=>!0))}(t.document,e.config.areas)?(0,c.Right)(void 0):(0,c.Left)(new Error("Failed to match areas.")))).fmap((()=>(0,n.fetch)(e.event.request,e.config,e.state.process))).fmap((async r=>(await r).fmap((([r,n])=>(0,i.update)(e,r,n,{document:t.document,position:o.loadPosition}))).extract(c.Left))).extract(c.Left)}},{"../store/path":124,"./model/eav/entity":109,"./module/fetch":111,"./module/update":113,"./module/update/content":115,"spica/either":15}],109:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RouterEntityState=r.RouterEntity=void 0;const n=e("spica/alias");r.RouterEntity=class{constructor(e,t,r){this.config=e,this.event=t,this.state=r,(0,n.ObjectFreeze)(this)}};r.RouterEntityState=class{constructor(e,t){this.process=e,this.scripts=t,(0,n.ObjectFreeze)(this)}}},{"spica/alias":4}],110:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FetchResponse=void 0;const n=e("spica/alias"),i=e("../../../../../../lib/html"),s=e("spica/url");r.FetchResponse=class{constructor(e,t){if(this.url=e,this.xhr=t,this.header=e=>this.xhr.getResponseHeader(e),this.document=this.xhr.responseXML.cloneNode(!0),e.origin!==new s.URL(t.responseURL,window.location.href).origin)throw new Error("Redirected to another origin.");(0,n.ObjectDefineProperty)(this.document,"URL",{configurable:!0,enumerable:!0,value:e.href,writable:!1}),(0,i.fix)(this.document),(0,n.ObjectFreeze)(this)}}},{"../../../../../../lib/html":139,"spica/alias":4,"spica/url":98}],111:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fetch=void 0;const n=e("../module/fetch/xhr"),i=e("spica/timer");r.fetch=async function({method:e,url:t,body:r},{fetch:{rewrite:s,cache:o,headers:c,timeout:a,wait:u},sequence:l},h){window.dispatchEvent(new Event("pjax:fetch"));const[d,p]=await Promise.all([await l.fetch(void 0,{path:t.path,method:e,headers:c,body:r}),(0,n.xhr)(e,t,c,r,a,s,o,h),(0,i.wait)(u)]);return p.bind(h.either).fmap((e=>[e,d]))}},{"../module/fetch/xhr":112,"spica/timer":95}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.match_=r.xhr=void 0;const n=e("../../model/eav/value/fetch"),i=e("spica/promise"),s=e("spica/sequence"),o=e("spica/either"),c=e("spica/cache"),a=e("spica/url"),u=new c.Cache(100),l=new c.Cache(100);function h(e,t){return s.Sequence.intersect(s.Sequence.from(r(e||"").sort()),s.Sequence.from(r(t).sort()),((e,t)=>e.localeCompare(t))).take(1).extract().length>0;function r(e){return e.split(/\s*;\s*/).filter((e=>e.length>0))}}r.xhr=function(e,t,r,s,c,d,p,f){(r=new Headers(r)).set("Accept",r.get("Accept")||"text/html");const m=new a.URL((0,a.standardize)(d(t.path),window.location.href));"GET"===e&&l.has(m.path)&&Date.now()>l.get(m.path).expiry&&r.set("If-None-Match",r.get("If-None-Match")||l.get(m.path).etag);const v="GET"===e&&p(m.path,r)||void 0;return new i.AtomicPromise((i=>{if(v&&u.has(v))return i((0,o.Right)(u.get(v)(t,m)));const d=new XMLHttpRequest;d.open(e,m.path,!0);for(const[e,t]of r)d.setRequestHeader(e,t);d.responseType="document",d.timeout=c,d.send(s),d.addEventListener("abort",(()=>{i((0,o.Left)(new Error("Failed to request a page by abort.")))})),d.addEventListener("error",(()=>{i((0,o.Left)(new Error("Failed to request a page by error.")))})),d.addEventListener("timeout",(()=>{i((0,o.Left)(new Error("Failed to request a page by timeout.")))})),d.addEventListener("load",(()=>{(function(e,t){return(0,o.Right)(e).bind((e=>{const r=new a.URL((0,a.standardize)(e.responseURL,window.location.href));switch(!0){case!e.responseURL:return(0,o.Left)(new Error("Failed to get the response URL."));case r.origin!==new a.URL("",window.location.origin).origin:return(0,o.Left)(new Error("Redirected to another origin."));case!/2..|304/.test(`${e.status}`):return(0,o.Left)(new Error("Failed to validate the status of response."));case!e.response:return"GET"===t&&304===e.status&&l.has(r.path)?(0,o.Right)(l.get(r.path).xhr):(0,o.Left)(new Error("Failed to get the response body."));case!h(e.getResponseHeader("Content-Type"),"text/html"):return(0,o.Left)(new Error("Failed to validate the content type of response."));default:return(0,o.Right)(e)}}))})(d,e).fmap((t=>{const r=new a.URL((0,a.standardize)(t.responseURL,window.location.href));if("GET"===e){const e=new Map(t.getResponseHeader("Cache-Control")?t.getResponseHeader("Cache-Control").trim().split(/\s*,\s*/).filter((e=>e.length>0)).map((e=>e.split("=").concat(""))):[]);for(const n of new Set([m.path,r.path]))t.getResponseHeader("ETag")&&!e.has("no-store")?l.set(n,{etag:t.getResponseHeader("ETag"),expiry:e.has("max-age")&&!e.has("no-cache")&&Date.now()+1e3*+e.get("max-age")||0,xhr:t}):l.delete(n)}return(e,i)=>new n.FetchResponse(r.path===i.path||i.path!==m.path&&v?e:r,t)})).fmap((e=>(v&&u.set(v,e),e(t,m)))).extract((e=>{i((0,o.Left)(e))}),(e=>{i((0,o.Right)(e))}))})),f.register((()=>{d.abort()}))}))},r.match_=h},{"../../model/eav/value/fetch":110,"spica/cache":7,"spica/either":15,"spica/promise":88,"spica/sequence":90,"spica/url":98}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.update=void 0;const n=e("../../event/router"),i=e("../module/update/blur"),s=e("../module/update/url"),o=e("../module/update/title"),c=e("../module/update/head"),a=e("../module/update/content"),u=e("../module/update/css"),l=e("../module/update/script"),h=e("../module/update/focus"),d=e("../module/update/scroll"),p=e("../../store/path"),f=e("spica/promise"),m=e("spica/either"),v=e("spica/hlist");r.update=function({event:e,config:t,state:r},b,y,g){const{process:w}=r,S={src:b.document,dst:g.document};return f.AtomicPromise.resolve(y).then(w.either).then((e=>e.bind((()=>(0,a.separate)(S,t.areas).extract((()=>(0,m.Left)(new Error("Failed to separate the areas."))),(()=>e)))).fmap((e=>(window.dispatchEvent(new Event("pjax:unload")),t.sequence.unload(e,{...b,url:b.url.href})))))).then((e=>m.Either.sequence(e))).then(w.promise).then((e=>e.bind((e=>(0,a.separate)(S,t.areas).fmap((([t])=>[e,t])).extract((()=>(0,m.Left)(new Error("Failed to separate the areas."))),w.either))).bind((([e,r])=>(t.update.rewrite(S.src,r),(0,a.separate)(S,t.areas).fmap((([,t])=>[e,t])).extract((()=>(0,m.Left)(new Error("Failed to separate the areas."))),w.either)))))).then(w.promise).then((y=>y.fmap((([y,q])=>(0,v.HList)().add(((0,i.blur)(S.dst),(0,p.savePjax)(),(0,s.url)(new n.RouterEventLocation(b.url),S.src.title,e.type,e.source,t.replace),(0,p.savePjax)(),(0,o.title)(S),(0,p.saveTitle)(),(0,c.head)(S,t.update.head,t.update.ignore),w.either((0,a.content)(S,q)).fmap((([e,t])=>[e,f.AtomicPromise.all(t)])))).unfold((async n=>(await n).fmap((async([n])=>{t.update.css&&(0,u.css)(S,t.update.ignore),g.document.dispatchEvent(new Event("pjax:content"));const i=await t.sequence.content(y,n),s=t.update.script?await(0,l.script)(S,r.scripts,t.update,10*Math.max(t.fetch.timeout,1e3),w):await w.either([[],f.AtomicPromise.resolve(w.either([]))]);return(0,h.focus)(e.type,S.dst),(0,d.scroll)(e.type,S.dst,{hash:e.location.dest.fragment,position:g.position}),(0,p.savePosition)(),g.document.dispatchEvent(new Event("pjax:ready")),[s.fmap((([e,t])=>[e,t.then((e=>e.extract()))])),await t.sequence.ready(i)]})).fmap((e=>e.then((([e,t])=>e.fmap((e=>[e,t])))))).extract((e=>f.AtomicPromise.resolve((0,m.Left)(e)))))).reverse())))).then(w.promise).then((e=>e.fmap((([e,r])=>(f.AtomicPromise.all([e,r]).then((([e,r])=>e.bind((([,e])=>r.fmap((([[,r],n])=>{f.AtomicPromise.all([e,r]).then(w.either).then((e=>e.fmap((([e])=>(window.dispatchEvent(new Event("pjax:load")),void t.sequence.load(n,e)))).extract((()=>{}))))})))).extract((()=>{})))),r))))).then((e=>m.Either.sequence(e).then((e=>e.join())))).then((e=>e.fmap((([e])=>e))))}},{"../../event/router":107,"../../store/path":124,"../module/update/blur":114,"../module/update/content":115,"../module/update/css":116,"../module/update/focus":117,"../module/update/head":118,"../module/update/script":119,"../module/update/scroll":120,"../module/update/title":122,"../module/update/url":123,"spica/either":15,"spica/hlist":22,"spica/promise":88}],114:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.blur=void 0,r.blur=function(e){e===window.document&&e.activeElement!==e.body&&(e.activeElement.blur(),e.body.focus())}},{}],115:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._wait=r._split=r.separate=r.content=void 0;const n=e("./script"),i=e("spica/promise"),s=e("spica/maybe"),o=e("spica/array"),c=e("typed-dom");function a(e){return(e.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[]).map((e=>e.trim())).reduce(((e,t)=>t?e.fmap((e=>(0,o.push)(e,[t]))):s.Nothing),(0,s.Just)([]))}function u(e){return i.AtomicPromise.race([new i.AtomicPromise((t=>{(0,c.once)(e,"load",t)})),new i.AtomicPromise((t=>{(0,c.once)(e,"abort",t)})),new i.AtomicPromise((t=>{(0,c.once)(e,"error",t)}))])}r.content=function(e,t,r={replace:(e,t)=>{t.parentNode.replaceChild(e,t)}}){return[t.map((e=>e.dst)).reduce(o.push,[]),t.map((function(t){return t.src.map(((r,n)=>({src:e.dst.importNode(t.src[n].cloneNode(!0),!0),dst:t.dst[n]}))).map((e=>(function(e){const t=[...e.src.querySelectorAll("script")].map(n.escape).reduce(((e,t)=>()=>(e(),void t())),(()=>{}));r.replace(e.src,e.dst),t()}(e),[...e.src.querySelectorAll("img, iframe, frame")].map(u)))).reduce(o.push,[])})).reduce(o.push,[])]},r.separate=function(e,t){return t.reduce(((t,r)=>s.Maybe.mplus(t,function(e,t){return a(t).bind((t=>t.reduce(((t,r)=>t.bind((t=>{const n={src:[...e.src.querySelectorAll(r)],dst:[...e.dst.querySelectorAll(r)]};return n.src.length>0&&n.src.length===n.dst.length?(0,s.Just)((0,o.push)(t,[n])):s.Nothing}))),(0,s.Just)([]))))}(e,r).fmap((e=>[r,e])))),s.Nothing)},r._split=a,r._wait=u},{"./script":119,"spica/array":5,"spica/maybe":28,"spica/promise":88,"typed-dom":100}],116:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.css=void 0;const n=e("./sync");r.css=function(e,t){return void["head","body"].map((t=>[e.src.querySelector(t),e.dst.querySelector(t)])).forEach((([e,t])=>{(0,n.sync)((0,n.pair)(r(e),r(t),((e,t)=>e.outerHTML===t.outerHTML)),t)}));function r(e){return[...e.querySelectorAll('link[rel~="stylesheet"], style')].filter((e=>!t||!e.matches(t)))}}},{"./sync":121}],117:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.focus=void 0;const n=e("../../../event/router");r.focus=function(e,t){switch(e){case n.RouterEventType.Click:case n.RouterEventType.Submit:return void[...t.querySelectorAll("[autofocus]")].slice(-1).filter((e=>e.closest("html")===window.document.documentElement&&e!==t.activeElement)).forEach((e=>{e.focus()}));case n.RouterEventType.Popstate:return;default:throw new TypeError(e)}}},{"../../../event/router":107}],118:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.head=void 0;const n=e("./sync");r.head=function(e,t,r){return r+=t.includes("link")?', link[rel~="stylesheet"]':"",void(0,n.sync)((0,n.pair)(i(e.src.head),i(e.dst.head),((e,t)=>e.outerHTML===t.outerHTML)),e.dst.head);function i(e){return[...e.querySelectorAll(t)].filter((e=>!r||!e.matches(r)))}}},{"./sync":121}],119:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.escape=r._evaluate=r._fetch=r.script=void 0;const o=e("spica/global"),c=e("spica/alias"),a=e("../../../../../lib/error"),u=e("spica/promise"),l=e("spica/either"),h=e("spica/url"),d=e("spica/array"),p=e("spica/tuple"),f=e("spica/timer"),m=e("typed-dom");async function v(e,t){return e.hasAttribute("src")?"module"===e.type.toLowerCase()?(0,l.Right)([e,""]):u.AtomicPromise.race([window.fetch(e.src,{headers:new Headers({Accept:"application/javascript"}),integrity:e.integrity}),(0,f.wait)(t).then((()=>u.AtomicPromise.reject(new Error(`${e.src}: Timeout.`))))]).then((async t=>t.ok?(0,l.Right)([e,await t.text()]):e.matches("[src][async]")?g(e).then((()=>(0,l.Right)([e,""])),(()=>(0,l.Left)(new Error(`${e.src}: ${t.statusText}`)))):(0,l.Left)(new Error(t.statusText))),(e=>(0,l.Left)(e))):(0,l.Right)([e,e.text])}function b(t,r,n,i,o,c){const d=!!(t=t.ownerDocument===document?t:document.importNode(t.cloneNode(!0),!0)).parentElement&&t.parentElement.matches(n.trim()||"_"),p=document.querySelector(d?t.parentElement.id?`#${t.parentElement.id}`:t.parentElement.tagName:"_")||document.body,f=y(t);p.appendChild(t),f(),!d&&t.remove();const m=u.AtomicPromise.resolve(o).then((function(){if(!c.alive)throw new a.FatalError("Expired.");if(t.matches('[type="module"][src]'))return u.AtomicPromise.resolve(Promise.resolve().then((()=>s(e(t.src))))).catch((e=>e.message.startsWith("Failed to load ")&&t.matches("[src][async]")?g(t).catch((()=>u.AtomicPromise.reject(e))):u.AtomicPromise.reject(e))).then((()=>(t.dispatchEvent(new Event("load")),(0,l.Right)(t))),(e=>(t.dispatchEvent(new Event("error")),(0,l.Left)(new a.FatalError(e instanceof Error?e.message:e+"")))));try{if(i.has(new h.URL((0,h.standardize)(window.location.href)).href))throw new a.FatalError("Expired.");return(0,eval)(r),t.hasAttribute("src")&&t.dispatchEvent(new Event("load")),u.AtomicPromise.resolve((0,l.Right)(t))}catch(e){return t.hasAttribute("src")&&t.dispatchEvent(new Event("error")),u.AtomicPromise.resolve((0,l.Left)(new a.FatalError(e instanceof Error?e.message:e+"")))}}));return t.matches("[src][async]")?(0,l.Right)(m):(0,l.Left)(m)}function y(e){const t=e.hasAttribute("src")?e.getAttribute("src"):null,r=e.text;return e.removeAttribute("src"),e.text="",()=>(e.text=" ",e.text=r,"string"==typeof t?void e.setAttribute("src",t):void 0)}function g(e){return new h.URL((0,h.standardize)(e.src)).origin===new h.URL((0,h.standardize)(window.location.href)).origin?u.AtomicPromise.reject(new Error):(e=(0,m.html)("script",(0,c.ObjectValues)(e.attributes).reduce(((e,{name:t,value:r})=>(e[t]=r,e)),{}),[...e.childNodes]),new u.AtomicPromise(((t,r)=>(e.addEventListener("load",(()=>{t(o.undefined)})),e.addEventListener("error",r),document.body.appendChild(e),void e.remove()))))}r.script=function(e,t,r,n,i,s={fetch:v,evaluate:b}){const o=[...e.src.querySelectorAll("script")].filter((e=>!e.type||/(?:application|text)\/(?:java|ecma)script|module/i.test(e.type))).filter((e=>!e.matches(r.ignore.trim()||"_"))).filter((e=>!e.hasAttribute("src")||(!t.has(new h.URL((0,h.standardize)(e.src)).href)||e.matches(r.reload.trim()||"_")))),{ss:c,as:a}=o.reduce(((e,t)=>{if(!0===t.matches("[src][async], [src][defer]"))e.as.push(t);else e.ss.push(t);return e}),{ss:[],as:[]});return u.AtomicPromise.all([u.AtomicPromise.all(f(c)).then(m),u.AtomicPromise.all(f(a)).then(m)]).then((async([e,t])=>e.fmap((async e=>(await e).fmap((([e,r])=>[e,r.then((async e=>t.fmap((async t=>(await t).fmap((([t,r])=>u.AtomicPromise.all([e,(0,l.Right)(t),r]).then((e=>e.reduce(((e,t)=>e.bind((e=>t.fmap((t=>(0,d.push)(e,t))))))))))).extract(l.Left))).extract(l.Left)))])))).extract(l.Left)));function f(e){return e.map((e=>s.fetch(e,n)))}function m(e){return e.reduce(((e,t)=>t.bind((()=>e))),e.reduce(((e,n)=>e.bind(i.either).bind((([e,o])=>n.fmap((([n,o])=>s.evaluate(n,o,r.logger,t,u.AtomicPromise.all(e),i))).bind((t=>t.extract((t=>(0,l.Right)((0,p.tuple)((0,d.push)(e,[t]),o))),(t=>(0,l.Right)((0,p.tuple)(e,(0,d.push)(o,[t])))))))))),(0,l.Right)([[],[]]))).fmap((([e,t])=>u.AtomicPromise.all(e).then((e=>l.Either.sequence(e))).then((e=>e.fmap((e=>(0,p.tuple)(e,Promise.all(t).then((e=>l.Either.sequence(e))))))))))}},r._fetch=v,r._evaluate=b,r.escape=y},{"../../../../../lib/error":138,"spica/alias":4,"spica/array":5,"spica/either":15,"spica/global":20,"spica/promise":88,"spica/timer":95,"spica/tuple":96,"spica/url":98,"typed-dom":100}],120:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._hash=r.scroll=void 0;const n=e("../../../event/router");function i(e,t,r={scrollToElement:e=>{e.scrollIntoView()}}){const n=t.slice(1);if(0===n.length)return!1;const i=e.getElementById(n)||e.getElementsByName(n)[0];return!!i&&(r.scrollToElement(i),!0)}r.scroll=function(e,t,r,s={scrollToElement:e=>{e.scrollIntoView()},scrollToPosition:({top:e,left:t})=>{window.scrollTo(t,e)},hash:i}){switch(e){case n.RouterEventType.Click:if(s.hash(t,r.hash,s))return;return void s.scrollToPosition({top:0,left:0});case n.RouterEventType.Submit:return void s.scrollToPosition({top:0,left:0});case n.RouterEventType.Popstate:return void s.scrollToPosition(r.position());default:throw new TypeError(e)}},r._hash=i},{"../../../event/router":107}],121:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pair=r.sync=void 0;const n=e("spica/either"),i=e("spica/array");function s(e,t,r){t.map((t=>e.ownerDocument.importNode(t.cloneNode(!0),!0))).forEach((t=>{e.insertBefore(t,r)}))}function o(e){e.remove()}r.sync=function(e,t,r={before:s,remove:o}){return void e.forEach((([e,n])=>(r.before(function(e){return e?e.parentElement:t}(n),e.slice(-1).some((e=>!!n&&e.outerHTML===n.outerHTML))?e.slice(0,-1):e,n),n&&0===e.length?void r.remove(n):void 0)))},r.pair=function(e,t,r){const s=function(e,t,r){return e.reduce(((e,s)=>0===t.length?e.set(null,(0,i.push)(e.get(null)||[],[s])):t.reduce(((e,t)=>e.bind((e=>!e.has(t)&&r(s,t)?(e.set(t,(0,i.push)(e.get(null)||[],[s])),e.delete(null),(0,n.Left)(e)):(0,n.Right)(e)))),(0,n.Right)(e)).fmap((e=>e.set(null,(0,i.push)(e.get(null)||[],[s])))).extract((e=>e))),new Map)}(e,t,r);return t.filter((e=>!s.has(e))).forEach((e=>{s.set(e,[])})),[...s].map((([e,t])=>[t,e]))}},{"spica/array":5,"spica/either":15}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.title=void 0,r.title=function(e){e.dst.title=e.src.title}},{}],123:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._isReplaceable=r._isRegisterable=r.url=void 0;const n=e("../../../event/router");function i(e,t){if(t.dest.href===t.orig.href)return!1;switch(e){case n.RouterEventType.Click:case n.RouterEventType.Submit:return!0;case n.RouterEventType.Popstate:return!1;default:throw new TypeError(e)}}function s(e,t,r){switch(e){case n.RouterEventType.Click:case n.RouterEventType.Submit:return t.matches(r.trim()||"_");case n.RouterEventType.Popstate:return!1;default:throw new TypeError(e)}}(0,e("typed-dom").bind)(document,"pjax:ready",(()=>{window.history.replaceState(window.history.state,window.document.title)})),r.url=function(e,t,r,n,o){switch(!0){case s(r,n,o):return void window.history.replaceState({},t,e.dest.href);case i(r,e):return void window.history.pushState({},t,e.dest.href);default:return}},r._isRegisterable=i,r._isReplaceable=s},{"../../../event/router":107,"typed-dom":100}],124:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("../../data/store/state"),r)},{"../../data/store/state":104}],125:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClickView=void 0;const n=e("spica/coroutine"),i=e("typed-dom");class s extends n.Coroutine{constructor(e,t,r){super((async function*(){return this.finally((0,i.delegate)(e,t,"click",(e=>{(e.currentTarget instanceof HTMLAnchorElement||e.currentTarget instanceof HTMLAreaElement)&&r(e)})))}),{delay:!1})}}r.ClickView=s},{"spica/coroutine":13,"typed-dom":100}],126:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NavigationView=void 0;const n=e("../../service/state/page"),i=e("../../../data/store/state"),s=e("spica/coroutine"),o=e("spica/url"),c=e("typed-dom");class a extends s.Coroutine{constructor(e,t){super((async function*(){return this.finally((0,c.bind)(e,"popstate",(r=>{(0,i.isTransitable)(n.page.state)&&(0,i.isTransitable)(e.history.state)&&(0,o.standardize)(e.location.href)!==n.page.href&&t(r)})))}),{delay:!1})}}r.NavigationView=a},{"../../../data/store/state":104,"../../service/state/page":133,"spica/coroutine":13,"spica/url":98,"typed-dom":100}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ScrollView=void 0;const n=e("../../service/state/page"),i=e("spica/coroutine"),s=e("spica/url"),o=e("spica/throttle"),c=e("typed-dom");class a extends i.Coroutine{constructor(e,t){super((async function*(){return this.finally((0,c.bind)(e,"scroll",(0,o.debounce)(100,(r=>{(0,s.standardize)(e.location.href)===n.page.href&&t(r)})),{passive:!0}))}),{delay:!1})}}r.ScrollView=a},{"../../service/state/page":133,"spica/coroutine":13,"spica/throttle":94,"spica/url":98,"typed-dom":100}],128:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SubmitView=void 0;const n=e("spica/coroutine"),i=e("typed-dom");class s extends n.Coroutine{constructor(e,t,r){super((async function*(){return this.finally((0,i.delegate)(e,t,"submit",(e=>{e.currentTarget instanceof HTMLFormElement&&r(e)})))}),{delay:!1})}}r.SubmitView=s},{"spica/coroutine":13,"typed-dom":100}],129:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.API=void 0;const n=e("./router"),i=e("./state/process"),s=e("../../data/store/state"),o=e("../../../lib/html"),c=e("spica/assign"),a=e("typed-dom");function u(e,t){const r=document.createElement("a");r.href=e,(0,o.parse)("").extract().body.appendChild(r),(0,a.once)(r,"click",t),(0,a.once)(r,"click",(e=>{e.preventDefault()})),r.click()}r.API=class{static assign(e,t,r={document:window.document,router:n.route}){let s;return u(e,(e=>s=r.router(new n.Config(t),new n.RouterEvent(e),i.process,r))),s}static replace(e,t,r={document:window.document,router:n.route}){let s;return u(e,(e=>s=r.router(new n.Config((0,c.assign)({},t,{replace:"*"})),new n.RouterEvent(e),i.process,r))),s}static sync(e){e&&(0,s.savePjax)(),i.process.cast("",new Error("Canceled.")),(0,n.sync)()}static pushURL(e,t,r=null){window.history.pushState(r,t,e),this.sync()}static replaceURL(e,t,r=window.history.state){const n=(0,s.isTransitable)(window.history.state);window.history.replaceState(r,t,e),this.sync(n)}}},{"../../../lib/html":139,"../../data/store/state":104,"./router":131,"./state/process":134,"spica/assign":6,"typed-dom":100}],130:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GUI=void 0;const n=e("./api"),i=e("../module/view/click"),s=e("../module/view/submit"),o=e("../module/view/navigation"),c=e("../module/view/scroll"),a=e("./router");e("./state/scroll-restoration");const u=e("./state/process"),l=e("../../application/store"),h=e("spica/supervisor"),d=e("spica/copropagator");class p extends n.API{constructor(e,t={document:window.document,router:a.route}){super(),this.option=e,this.io=t,this.view=new f(this.option,this.io),p.resources.clear(),p.resources.register("view",this.view)}assign(e){return n.API.assign(e,this.option,this.io)}replace(e){return n.API.replace(e,this.option,this.io)}}r.GUI=p,p.resources=new class extends h.Supervisor{};class f extends d.Copropagator{constructor(e,t){const r=new a.Config(e),n=e=>{t.router(r,new a.RouterEvent(e),u.process,t)};super([new i.ClickView(t.document,r.link,n),new s.SubmitView(t.document,r.form,n),new o.NavigationView(window,n),new c.ScrollView(window,l.savePosition)])}}},{"../../application/store":103,"../module/view/click":125,"../module/view/navigation":126,"../module/view/scroll":127,"../module/view/submit":128,"./api":129,"./router":131,"./state/process":134,"./state/scroll-restoration":136,"spica/copropagator":12,"spica/supervisor":93}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._validate=r.sync=r.route=r.RouterEventSource=r.RouterEvent=r.Config=void 0;const n=e("../../application/router");Object.defineProperty(r,"Config",{enumerable:!0,get:function(){return n.Config}}),Object.defineProperty(r,"RouterEvent",{enumerable:!0,get:function(){return n.RouterEvent}}),Object.defineProperty(r,"RouterEventSource",{enumerable:!0,get:function(){return n.RouterEventSource}});const i=e("./state/page"),s=e("../service/state/env"),o=e("../../../lib/error"),c=e("../../application/store"),a=e("spica/url"),u=e("spica/cancellation"),l=e("spica/maybe"),h=e("spica/promise");function d(e,t,r){if(r.original.defaultPrevented)return!1;switch(r.type){case n.RouterEventType.Click:return o(e)&&(s=e,!(new a.URL(i.page.href).resource===s.resource&&""!==s.fragment))&&!p(e)&&!r.source.hasAttribute("download")&&!function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey}(r.original)&&t.filter(r.source);case n.RouterEventType.Submit:return o(e);case n.RouterEventType.Popstate:return o(e)&&!p(e);default:return!1}var s;function o(e){return new a.URL(i.page.href).origin===e.origin}}function p(e){const t=new a.URL(i.page.href);return t.resource===e.resource&&t.fragment!==e.fragment}(0,e("typed-dom").bind)(window,"pjax:unload",(()=>window.history.scrollRestoration="auto"),!0),r.route=function(e,t,r,f){switch(t.type){case n.RouterEventType.Click:case n.RouterEventType.Submit:(0,c.savePosition)();break;case n.RouterEventType.Popstate:f.document.title=(0,c.loadTitle)()}return(0,l.Just)(0).guard(d(t.request.url,e,t)).bind((()=>(0,n.scope)(e,(({orig:e,dest:t})=>({orig:e.pathname,dest:t.pathname}))(t.location)))).fmap((async e=>{t.original.preventDefault(),r.cast("",new Error("Canceled."));const c=new u.Cancellation,l=r.register("",(e=>(l(),c.cancel(e),h.never))),[d]=await s.env;return window.history.scrollRestoration="manual",(0,n.route)(e,t,{process:c,scripts:d},f).then((e=>e.fmap((async([e,t])=>(l(),i.page.sync(),e.filter((e=>e.hasAttribute("src"))).forEach((e=>{d.add(new a.URL((0,a.standardize)(e.src)).href)})),void(await t).filter((e=>e.hasAttribute("src"))).forEach((e=>{d.add(new a.URL((0,a.standardize)(e.src)).href)}))))).extract())).catch((r=>(l(),i.page.sync(),window.history.scrollRestoration="auto",c.alive||r instanceof o.FatalError?void e.fallback(t.source,r):void 0)))})).extract((()=>{switch(t.type){case n.RouterEventType.Click:return t.source.matches("[href]")&&r.cast("",new Error("Canceled.")),i.page.sync(),!1;case n.RouterEventType.Submit:return r.cast("",new Error("Canceled.")),i.page.sync(),!1;case n.RouterEventType.Popstate:return p(t.location.dest)?(r.cast("",new Error("Canceled.")),i.page.sync(),!1):(e.fallback(t.source,new Error("Disabled.")),i.page.sync(),!0)}}),(()=>!0))},r.sync=function(){i.page.sync()},r._validate=d},{"../../../lib/error":138,"../../application/router":102,"../../application/store":103,"../service/state/env":132,"./state/page":133,"spica/cancellation":8,"spica/maybe":28,"spica/promise":88,"spica/url":98,"typed-dom":100}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.env=void 0;const n=e("./script");r.env=Promise.all([n.scripts,new Promise((e=>{setTimeout(e)}))])},{"./script":135}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.page=void 0;const n=e("spica/global"),i=e("../../../data/store/state"),s=e("spica/url"),o=e("typed-dom");(0,o.bind)(n.window,"hashchange",(()=>{r.page.sync()})),(0,o.bind)(n.window,"popstate",(()=>(0,i.isTransitable)(r.page.state)&&(0,i.isTransitable)(n.window.history.state)||void r.page.sync())),r.page=new class{constructor(){this.url=(0,s.standardize)(n.window.location.href),this.state_=n.window.history.state}get href(){return this.url}get state(){return this.state_}sync(){this.url=(0,s.standardize)(n.window.location.href),this.state_=n.window.history.state}}},{"../../../data/store/state":104,"spica/global":20,"spica/url":98,"typed-dom":100}],134:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.process=void 0;const n=e("spica/supervisor");r.process=new class extends n.Supervisor{}},{"spica/supervisor":93}],135:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scripts=void 0;const n=e("spica/url"),i=e("typed-dom");r.scripts=new Set,(0,i.bind)(window,"pjax:unload",(()=>{document.querySelectorAll("script[src]").forEach((e=>{r.scripts.add(new n.URL((0,n.standardize)(e.src)).href)}))}))},{"spica/url":98,"typed-dom":100}],136:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});(0,e("typed-dom").bind)(window,"unload",(()=>window.history.scrollRestoration="auto"),!1)},{"typed-dom":100}],137:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.serialize=void 0,r.serialize=function(e){return[...e.elements].filter((e=>{if(!("name"in e))return!1;if(e.disabled)return!1;switch(e.tagName){case"INPUT":switch(e.type.toLowerCase()){case"checkbox":case"radio":return e.checked;case"submit":case"button":case"image":case"reset":case"file":return!1;default:return!0}case"SELECT":case"TEXTAREA":return!0;default:return!1}})).map((e=>[encodeURIComponent(t(e.name)),encodeURIComponent(t(e.value))].join("="))).join("&");function t(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,(e=>2===e.length?e:""))}}},{}],138:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FatalError=void 0;class n extends Error{constructor(e){super(e)}}r.FatalError=n,Error.prototype.name="Error",n.prototype.name="FatalError"},{}],139:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._fixNoscript=r.fix=r.parse=void 0;const n=e("spica/maybe"),i=e("spica/either");function s(e){o(e).forEach((([e,t])=>e.textContent=t.textContent))}function o(e){return[...e.querySelectorAll("noscript")].filter((e=>e.children.length>0)).map((e=>{const t=e.cloneNode(!0);return t.textContent=e.innerHTML,[e,t]}))}r.parse=[function(e){const t=(new DOMParser).parseFromString(e,"text/html");return s(t),t},function(e){const t=window.document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),s(t),t}].reduce(((e,t)=>e.bind((()=>function(e){try{const t=e('\n<html lang="en" class="html">\n  <head>\n    <link href="/">\n    <title>&amp;</title>\n    <noscript><style>/**/</style></noscript>\n  </head>\n  <body>\n    <noscript>noscript</noscript>\n    <a href="/"></a>\n    <script>document.head.remove();<\/script>\n    <img src="abc">\n  </body>\n</html>\n');switch(!1){case"&"===t.title:case!!t.querySelector('html.html[lang="en"]'):case!!t.querySelector("head > link").href:case!!t.querySelector("body > a").href:case!t.querySelector("head > noscript > *"):case"document.head.remove();"===t.querySelector("script").innerHTML:case t.querySelector("img").src.endsWith("abc"):case"<style>/**/</style>"===t.querySelector("head > noscript").textContent:case"noscript"===t.querySelector("body > noscript").textContent:throw void 0}return!0}catch(e){return!1}}(t)?(0,i.Left)(t):e))),(0,i.Right)((()=>n.Nothing))).extract((e=>t=>(0,n.Just)(e(t)))),r.fix=s,r._fixNoscript=o},{"spica/either":15,"spica/maybe":28}],"pjax-api":[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=e("./src/export");Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s(o).default}}),i(e("./src/export"),r)},{"./src/export":101}]},{},[1,2,3,"pjax-api"]),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.commonJsStrict=t()}("undefined"!=typeof self?self:this,(function(){return require("pjax-api")}));
//# sourceMappingURL=/sm/455bdcb34fe01073cc1767402af29fcf51e879f4c5e56e807cef56084a830fdc.map